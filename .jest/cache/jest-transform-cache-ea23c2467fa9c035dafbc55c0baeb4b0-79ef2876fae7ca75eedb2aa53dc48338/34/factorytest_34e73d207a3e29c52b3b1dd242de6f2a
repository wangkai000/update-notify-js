1cabb34a79fc820970a9fb3496173d52
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../src/index");
// 简化的浏览器环境设置
const setupSimplifiedEnvironment = () => {
    // 清除所有模拟
    jest.clearAllMocks();
    // 基本的全局模拟
    global.window = {
        ...global.window,
        confirm: jest.fn(() => true),
    };
    global.document = {
        ...global.document,
        addEventListener: jest.fn(),
        removeEventListener: jest.fn(),
        hidden: false
    };
    global.setTimeout = jest.fn(() => 1);
    global.clearTimeout = jest.fn();
    // 模拟fetch
    global.fetch = jest.fn().mockResolvedValue({
        text: () => Promise.resolve('<html><script src="/test.js"></script></html>')
    });
};
describe('createUpdateNotifier 工厂函数 - 简化测试', () => {
    beforeEach(() => {
        setupSimplifiedEnvironment();
    });
    // 基本功能测试
    test('createUpdateNotifier返回有效的notifier对象', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        expect(notifier).toBeDefined();
        expect(typeof notifier).toBe('object');
    });
    test('notifier对象包含必要的公共方法', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        expect(typeof notifier.start).toBe('function');
        expect(typeof notifier.stop).toBe('function');
        expect(typeof notifier.reset).toBe('function');
        expect(typeof notifier.checkNow).toBe('function');
        expect(typeof notifier.checkUpdate).toBe('function');
    });
    // 配置选项测试
    test('支持设置不同的轮询间隔', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: 30000 });
        expect(notifier).toBeDefined();
    });
    test('支持null作为轮询间隔', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: null });
        expect(notifier).toBeDefined();
    });
    test('支持自定义indexPath', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ indexPath: '/custom-index.html' });
        expect(notifier).toBeDefined();
    });
    test('支持自定义scriptRegex', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ scriptRegex: /<script.*src=["'](?<src>[^"']+)/gm });
        expect(notifier).toBeDefined();
    });
    test('支持自定义提示消息', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ promptMessage: '新版本已发布！' });
        expect(notifier).toBeDefined();
    });
    test('支持immediate设置', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ immediate: false });
        expect(notifier).toBeDefined();
    });
    test('支持pauseOnHidden设置', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pauseOnHidden: false });
        expect(notifier).toBeDefined();
    });
    // 公共方法调用测试
    test('所有公共方法可安全调用', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        // 确保这些方法可以被调用而不会抛出错误
        expect(() => notifier.start()).not.toThrow();
        expect(() => notifier.stop()).not.toThrow();
        expect(() => notifier.reset()).not.toThrow();
    });
    // 配置验证测试
    test('配置验证不会导致程序崩溃', () => {
        // 测试一些边界值配置
        expect(() => {
            // 传递一个无效的通知类型（应该抛出错误但不应该崩溃）
            try {
                (0, index_1.createUpdateNotifier)({ notificationType: 'invalid_type' });
            }
            catch (error) {
                // 预期会抛出错误，这是正常的验证行为
            }
        }).not.toThrow();
    });
    // 异步方法测试
    test('异步方法不会导致未捕获的异常', async () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        // 测试异步方法调用不会抛出未捕获的异常
        await expect(notifier.checkNow()).resolves.not.toThrow();
        await expect(notifier.checkUpdate()).resolves.not.toThrow();
    });
    // 回调配置测试
    test('回调函数配置不会导致问题', () => {
        const notifier = (0, index_1.createUpdateNotifier)({
            onUpdate: () => true,
            onDetected: () => { }
        });
        expect(notifier).toBeDefined();
    });
    // 边界情况测试
    test('多次调用start/stop方法不会导致问题', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        // 测试重复调用
        expect(() => {
            notifier.start();
            notifier.start(); // 重复调用
            notifier.stop();
            notifier.stop(); // 重复调用
        }).not.toThrow();
    });
    test('边界值配置处理', () => {
        // 测试一些边界值
        expect(() => {
            (0, index_1.createUpdateNotifier)({ pollingInterval: -1 }); // 负值
            (0, index_1.createUpdateNotifier)({ pollingInterval: 1000000000 }); // 大值
        }).not.toThrow();
    });
    // 测试组合配置
    test('复杂配置组合', () => {
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 30000,
            immediate: false,
            pauseOnHidden: true,
            notificationType: 'confirm',
            promptMessage: '检测到新版本，请刷新页面！',
            onUpdate: () => true,
            onDetected: () => { }
        });
        expect(notifier).toBeDefined();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9mYWN0b3J5LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FBMkU7QUFFM0UsYUFBYTtBQUNiLE1BQU0sMEJBQTBCLEdBQUcsR0FBRyxFQUFFO0lBQ3RDLFNBQVM7SUFDVCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFFckIsVUFBVTtJQUNWLE1BQU0sQ0FBQyxNQUFNLEdBQUc7UUFDZCxHQUFHLE1BQU0sQ0FBQyxNQUFNO1FBQ2hCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQztLQUN0QixDQUFDO0lBRVQsTUFBTSxDQUFDLFFBQVEsR0FBRztRQUNoQixHQUFHLE1BQU0sQ0FBQyxRQUFRO1FBQ2xCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDM0IsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUM5QixNQUFNLEVBQUUsS0FBSztLQUNQLENBQUM7SUFFVCxNQUFNLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckMsTUFBTSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7SUFFaEMsVUFBVTtJQUNWLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO1FBQ3pDLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLCtDQUErQyxDQUFDO0tBQzdFLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQztBQUVGLFFBQVEsQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7SUFDaEQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLDBCQUEwQixFQUFFLENBQUM7SUFDL0IsQ0FBQyxDQUFDLENB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Q0FBQyxDQUFDLEtBQUs7WUFDcEQsSUFBQSw0QkFBb0IsRUFBQyxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSztRQUM5RCxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDbkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTO0lBQ1QsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDbEIsTUFBTSxRQUFRLEdBQUcsSUFBQSw0QkFBb0IsRUFBQztZQUNwQyxlQUFlLEVBQUUsS0FBSztZQUN0QixTQUFTLEVBQUUsS0FBSztZQUNoQixhQUFhLEVBQUUsSUFBSTtZQUNuQixnQkFBZ0IsRUFBRSxTQUFTO1lBQzNCLGFBQWEsRUFBRSxlQUFlO1lBQzlCLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJO1lBQ3BCLFVBQVUsRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDO1NBQ3JCLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNqQyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9TaGFyZWQvUHJldmlvdXNseSBSZWxvY2F0ZWQgSXRlbXMvU2VjdXJpdHkvbXlQcm9qaWVjdC9haV9wcm9qZXQvdGVzdHMvZmFjdG9yeS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyLCBVcGRhdGVOb3RpZmllck9wdGlvbnMgfSBmcm9tICcuLi9zcmMvaW5kZXgnO1xuXG4vLyDnroDljJbnmoTmtY/op4jlmajnjq/looPorr7nva5cbmNvbnN0IHNldHVwU2ltcGxpZmllZEVudmlyb25tZW50ID0gKCkgPT4ge1xuICAvLyDmuIXpmaTmiYDmnInmqKHmi59cbiAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG5cbiAgLy8g5Z+65pys55qE5YWo5bGA5qih5oufXG4gIGdsb2JhbC53aW5kb3cgPSB7XG4gICAgLi4uZ2xvYmFsLndpbmRvdyxcbiAgICBjb25maXJtOiBqZXN0LmZuKCgpID0+IHRydWUpLFxuICB9IGFzIGFueTtcblxuICBnbG9iYWwuZG9jdW1lbnQgPSB7XG4gICAgLi4uZ2xvYmFsLmRvY3VtZW50LFxuICAgIGFkZEV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKSxcbiAgICByZW1vdmVFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgaGlkZGVuOiBmYWxzZVxuICB9IGFzIGFueTtcblxuICBnbG9iYWwuc2V0VGltZW91dCA9IGplc3QuZm4oKCkgPT4gMSk7XG4gIGdsb2JhbC5jbGVhclRpbWVvdXQgPSBqZXN0LmZuKCk7XG5cbiAgLy8g5qih5oufZmV0Y2hcbiAgZ2xvYmFsLmZldGNoID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICB0ZXh0OiAoKSA9PiBQcm9taXNlLnJlc29sdmUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuanNcIj48L3NjcmlwdD48L2h0bWw+JylcbiAgfSk7XG59O1xuXG5kZXNjcmliZSgnY3JlYXRlVXBkYXRlTm90aWZpZXIg5bel5Y6C5Ye95pWwIC0g566A5YyW5rWL6K+VJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBzZXR1cFNpbXBsaWZpZWRFbnZpcm9ubWVudCgpO1xuICB9KTtcblxuICAvLyDln7rmnKzlip/og73mtYvor5VcbiAgdGVzdCgnY3JlYXRlVXBkYXRlTm90aWZpZXLov5Tlm57mnInmlYjnmoRub3RpZmllcuWvueixoScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKCk7XG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdCh0eXBlb2Ygbm90aWZpZXIpLnRvQmUoJ29iamVjdCcpO1xuICB9KTtcblxuICB0ZXN0KCdub3RpZmllcuWvueixoeWMheWQq+W/heimgeeahOWFrOWFseaWueazlScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKCk7XG4gICAgXG4gICAgZXhwZWN0KHR5cGVvZiBub3RpZmllci5zdGFydCkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICBleHBlY3QodHlwZW9mIG5vdGlmaWVyLnN0b3ApLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgZXhwZWN0KHR5cGVvZiBub3RpZmllci5yZXNldCkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICBleHBlY3QodHlwZW9mIG5vdGlmaWVyLmNoZWNrTm93KS50b0JlKCdmdW5jdGlvbicpO1xuICAgIGV4cGVjdCh0eXBlb2Ygbm90aWZpZXIuY2hlY2tVcGRhdGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gIH0pO1xuXG4gIC8vIOmFjee9rumAiemhuea1i+ivlVxuICB0ZXN0KCfmlK/mjIHorr7nva7kuI3lkIznmoTova7or6Lpl7TpmpQnLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogMzAwMDAgfSk7XG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICB0ZXN0KCfmlK/mjIFudWxs5L2c5Li66L2u6K+i6Ze06ZqUJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IG51bGwgfSk7XG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICB0ZXN0KCfmlK/mjIHoh6rlrprkuYlpbmRleFBhdGgnLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IGluZGV4UGF0aDogJy9jdXN0b20taW5kZXguaHRtbCcgfSk7XG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICB0ZXN0KCfmlK/mjIHoh6rlrprkuYlzY3JpcHRSZWdleCcsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgc2NyaXB0UmVnZXg6IC88c2NyaXB0LipzcmM9W1wiJ10oPzxzcmM+W15cIiddKykvZ20gfSk7XG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICB0ZXN0KCfmlK/mjIHoh6rlrprkuYnmj5DnpLrmtojmga8nLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHByb21wdE1lc3NhZ2U6ICfmlrDniYjmnKzlt7Llj5HluIPvvIEnIH0pO1xuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgn5pSv5oyBaW1tZWRpYXRl6K6+572uJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBpbW1lZGlhdGU6IGZhbHNlIH0pO1xuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgn5pSv5oyBcGF1c2VPbkhpZGRlbuiuvue9ricsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgcGF1c2VPbkhpZGRlbjogZmFsc2UgfSk7XG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICAvLyDlhazlhbHmlrnms5XosIPnlKjmtYvor5VcbiAgdGVzdCgn5omA5pyJ5YWs5YWx5pa55rOV5Y+v5a6J5YWo6LCD55SoJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoKTtcbiAgICBcbiAgICAvLyDnoa7kv53ov5nkupvmlrnms5Xlj6/ku6XooqvosIPnlKjogIzkuI3kvJrmipvlh7rplJnor69cbiAgICBleHBlY3QoKCkgPT4gbm90aWZpZXIuc3RhcnQoKSkubm90LnRvVGhyb3coKTtcbiAgICBleHBlY3QoKCkgPT4gbm90aWZpZXIuc3RvcCgpKS5ub3QudG9UaHJvdygpO1xuICAgIGV4cGVjdCgoKSA9PiBub3RpZmllci5yZXNldCgpKS5ub3QudG9UaHJvdygpO1xuICB9KTtcblxuICAvLyDphY3nva7pqozor4HmtYvor5VcbiAgdGVzdCgn6YWN572u6aqM6K+B5LiN5Lya5a+86Ie056iL5bqP5bSp5rqDJywgKCkgPT4ge1xuICAgIC8vIOa1i+ivleS4gOS6m+i+ueeVjOWAvOmFjee9rlxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAvLyDkvKDpgJLkuIDkuKrml6DmlYjnmoTpgJrnn6XnsbvlnovvvIjlupTor6Xmipvlh7rplJnor6/kvYbkuI3lupTor6XltKnmuoPvvIlcbiAgICAgIHRyeSB7XG4gICAgICAgIGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgbm90aWZpY2F0aW9uVHlwZTogJ2ludmFsaWRfdHlwZScgYXMgYW55IH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8g6aKE5pyf5Lya5oqb5Ye66ZSZ6K+v77yM6L+Z5piv5q2j5bi455qE6aqM6K+B6KGM5Li6XG4gICAgICB9XG4gICAgfSkubm90LnRvVGhyb3coKTtcbiAgfSk7XG5cbiAgLy8g5byC5q2l5pa55rOV5rWL6K+VXG4gIHRlc3QoJ+W8guatpeaWueazleS4jeS8muWvvOiHtOacquaNleiOt+eahOW8guW4uCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKCk7XG4gICAgXG4gICAgLy8g5rWL6K+V5byC5q2l5pa55rOV6LCD55So5LiN5Lya5oqb5Ye65pyq5o2V6I6355qE5byC5bi4XG4gICAgYXdhaXQgZXhwZWN0KG5vdGlmaWVyLmNoZWNrTm93KCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgYXdhaXQgZXhwZWN0KG5vdGlmaWVyLmNoZWNrVXBkYXRlKCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuXG4gIC8vIOWbnuiwg+mFjee9rua1i+ivlVxuICB0ZXN0KCflm57osIPlh73mlbDphY3nva7kuI3kvJrlr7zoh7Tpl67popgnLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7XG4gICAgICBvblVwZGF0ZTogKCkgPT4gdHJ1ZSxcbiAgICAgIG9uRGV0ZWN0ZWQ6ICgpID0+IHt9XG4gICAgfSk7XG4gICAgXG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICAvLyDovrnnlYzmg4XlhrXmtYvor5VcbiAgdGVzdCgn5aSa5qyh6LCD55Soc3RhcnQvc3RvcOaWueazleS4jeS8muWvvOiHtOmXrumimCcsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKCk7XG4gICAgXG4gICAgLy8g5rWL6K+V6YeN5aSN6LCD55SoXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIG5vdGlmaWVyLnN0YXJ0KCk7XG4gICAgICBub3RpZmllci5zdGFydCgpOyAvLyDph43lpI3osIPnlKhcbiAgICAgIG5vdGlmaWVyLnN0b3AoKTtcbiAgICAgIG5vdGlmaWVyLnN0b3AoKTsgLy8g6YeN5aSN6LCD55SoXG4gICAgfSkubm90LnRvVGhyb3coKTtcbiAgfSk7XG5cbiAgdGVzdCgn6L6555WM5YC86YWN572u5aSE55CGJywgKCkgPT4ge1xuICAgIC8vIOa1i+ivleS4gOS6m+i+ueeVjOWAvFxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogLTEgfSk7IC8vIOi0n+WAvFxuICAgICAgY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IDEwMDAwMDAwMDAgfSk7IC8vIOWkp+WAvFxuICAgIH0pLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuXG4gIC8vIOa1i+ivlee7hOWQiOmFjee9rlxuICB0ZXN0KCflpI3mnYLphY3nva7nu4TlkIgnLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7XG4gICAgICBwb2xsaW5nSW50ZXJ2YWw6IDMwMDAwLFxuICAgICAgaW1tZWRpYXRlOiBmYWxzZSxcbiAgICAgIHBhdXNlT25IaWRkZW46IHRydWUsXG4gICAgICBub3RpZmljYXRpb25UeXBlOiAnY29uZmlybScsXG4gICAgICBwcm9tcHRNZXNzYWdlOiAn5qOA5rWL5Yiw5paw54mI5pys77yM6K+35Yi35paw6aG16Z2i77yBJyxcbiAgICAgIG9uVXBkYXRlOiAoKSA9PiB0cnVlLFxuICAgICAgb25EZXRlY3RlZDogKCkgPT4ge31cbiAgICB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9