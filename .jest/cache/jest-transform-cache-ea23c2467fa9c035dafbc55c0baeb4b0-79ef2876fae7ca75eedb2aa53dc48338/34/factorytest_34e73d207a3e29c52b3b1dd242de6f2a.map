{"file":"/Users/Shared/Previously Relocated Items/Security/myProjiect/ai_projet/tests/factory.test.ts","mappings":"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","names":[],"sources":["/Users/Shared/Previously Relocated Items/Security/myProjiect/ai_projet/tests/factory.test.ts"],"sourcesContent":["import { createUpdateNotifier, UpdateNotifierOptions } from '../src/index';\n\n// 简化的浏览器环境设置\nconst setupSimplifiedEnvironment = () => {\n  // 清除所有模拟\n  jest.clearAllMocks();\n\n  // 基本的全局模拟\n  global.window = {\n    ...global.window,\n    confirm: jest.fn(() => true),\n  } as any;\n\n  global.document = {\n    ...global.document,\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    hidden: false\n  } as any;\n\n  global.setTimeout = jest.fn(() => 1);\n  global.clearTimeout = jest.fn();\n\n  // 模拟fetch\n  global.fetch = jest.fn().mockResolvedValue({\n    text: () => Promise.resolve('<html><script src=\"/test.js\"></script></html>')\n  });\n};\n\ndescribe('createUpdateNotifier 工厂函数 - 简化测试', () => {\n  beforeEach(() => {\n    setupSimplifiedEnvironment();\n  });\n\n  // 基本功能测试\n  test('createUpdateNotifier返回有效的notifier对象', () => {\n    const notifier = createUpdateNotifier();\n    expect(notifier).toBeDefined();\n    expect(typeof notifier).toBe('object');\n  });\n\n  test('notifier对象包含必要的公共方法', () => {\n    const notifier = createUpdateNotifier();\n    \n    expect(typeof notifier.start).toBe('function');\n    expect(typeof notifier.stop).toBe('function');\n    expect(typeof notifier.reset).toBe('function');\n    expect(typeof notifier.checkNow).toBe('function');\n    expect(typeof notifier.checkUpdate).toBe('function');\n  });\n\n  // 配置选项测试\n  test('支持设置不同的轮询间隔', () => {\n    const notifier = createUpdateNotifier({ pollingInterval: 30000 });\n    expect(notifier).toBeDefined();\n  });\n\n  test('支持null作为轮询间隔', () => {\n    const notifier = createUpdateNotifier({ pollingInterval: null });\n    expect(notifier).toBeDefined();\n  });\n\n  test('支持自定义indexPath', () => {\n    const notifier = createUpdateNotifier({ indexPath: '/custom-index.html' });\n    expect(notifier).toBeDefined();\n  });\n\n  test('支持自定义scriptRegex', () => {\n    const notifier = createUpdateNotifier({ scriptRegex: /<script.*src=[\"'](?<src>[^\"']+)/gm });\n    expect(notifier).toBeDefined();\n  });\n\n  test('支持自定义提示消息', () => {\n    const notifier = createUpdateNotifier({ promptMessage: '新版本已发布！' });\n    expect(notifier).toBeDefined();\n  });\n\n  test('支持immediate设置', () => {\n    const notifier = createUpdateNotifier({ immediate: false });\n    expect(notifier).toBeDefined();\n  });\n\n  test('支持pauseOnHidden设置', () => {\n    const notifier = createUpdateNotifier({ pauseOnHidden: false });\n    expect(notifier).toBeDefined();\n  });\n\n  // 公共方法调用测试\n  test('所有公共方法可安全调用', () => {\n    const notifier = createUpdateNotifier();\n    \n    // 确保这些方法可以被调用而不会抛出错误\n    expect(() => notifier.start()).not.toThrow();\n    expect(() => notifier.stop()).not.toThrow();\n    expect(() => notifier.reset()).not.toThrow();\n  });\n\n  // 配置验证测试\n  test('配置验证不会导致程序崩溃', () => {\n    // 测试一些边界值配置\n    expect(() => {\n      // 传递一个无效的通知类型（应该抛出错误但不应该崩溃）\n      try {\n        createUpdateNotifier({ notificationType: 'invalid_type' as any });\n      } catch (error) {\n        // 预期会抛出错误，这是正常的验证行为\n      }\n    }).not.toThrow();\n  });\n\n  // 异步方法测试\n  test('异步方法不会导致未捕获的异常', async () => {\n    const notifier = createUpdateNotifier();\n    \n    // 测试异步方法调用不会抛出未捕获的异常\n    await expect(notifier.checkNow()).resolves.not.toThrow();\n    await expect(notifier.checkUpdate()).resolves.not.toThrow();\n  });\n\n  // 回调配置测试\n  test('回调函数配置不会导致问题', () => {\n    const notifier = createUpdateNotifier({\n      onUpdate: () => true,\n      onDetected: () => {}\n    });\n    \n    expect(notifier).toBeDefined();\n  });\n\n  // 边界情况测试\n  test('多次调用start/stop方法不会导致问题', () => {\n    const notifier = createUpdateNotifier();\n    \n    // 测试重复调用\n    expect(() => {\n      notifier.start();\n      notifier.start(); // 重复调用\n      notifier.stop();\n      notifier.stop(); // 重复调用\n    }).not.toThrow();\n  });\n\n  test('边界值配置处理', () => {\n    // 测试一些边界值\n    expect(() => {\n      createUpdateNotifier({ pollingInterval: -1 }); // 负值\n      createUpdateNotifier({ pollingInterval: 1000000000 }); // 大值\n    }).not.toThrow();\n  });\n\n  // 测试组合配置\n  test('复杂配置组合', () => {\n    const notifier = createUpdateNotifier({\n      pollingInterval: 30000,\n      immediate: false,\n      pauseOnHidden: true,\n      notificationType: 'confirm',\n      promptMessage: '检测到新版本，请刷新页面！',\n      onUpdate: () => true,\n      onDetected: () => {}\n    });\n    \n    expect(notifier).toBeDefined();\n  });\n});"],"version":3}