{"file":"/Users/Shared/Previously Relocated Items/Security/myProjiect/ai_projet/src/index.ts","mappings":"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","names":[],"sources":["/Users/Shared/Previously Relocated Items/Security/myProjiect/ai_projet/src/index.ts"],"sourcesContent":["/**\n * 版本更新检测配置选项\n */\nexport interface UpdateNotifierOptions {\n  /** \n   * 轮询间隔时间，单位毫秒，默认 10000ms (10秒)\n   * 设置为 null 或 0 则禁用自动轮询（需手动调用 checkUpdate）\n   */\n  pollingInterval?: number | null;\n  /** 提示用户更新的方式，默认 'confirm' */\n  notifyType?: 'confirm' | 'custom';\n  /** 自定义提示函数，返回 true 表示确认刷新 */\n  onUpdate?: () => boolean | Promise<boolean>;\n  /** 检测到更新时的回调 */\n  onDetected?: () => void;\n  /** 是否在页面隐藏时暂停检测，默认 true（仅在自动轮询模式下有效） */\n  pauseOnHidden?: boolean;\n  /** 是否立即开始检测，默认 true（仅在自动轮询模式下有效） */\n  immediate?: boolean;\n  /** 自定义请求路径，默认 '/' */\n  indexPath?: string;\n  /** script 标签正则匹配，用于自定义匹配规则 */\n  scriptRegex?: RegExp;\n  /** 是否在控制台输出日志，默认 false */\n  debug?: boolean;\n  /** 默认 confirm 提示文案（用于 notifyType='confirm'） */\n  promptMessage?: string;\n}\n\n/**\n * 版本更新检测配置选项（内部使用）\n */\ninterface InternalOptions extends Omit<UpdateNotifierOptions, 'pollingInterval'> {\n  pollingInterval: number;\n}\n\n/**\n * 版本更新通知器类\n */\nclass VersionUpdateNotifier {\n  private lastSrcs: string[] | null = null;\n  private timerId: number | null = null;\n  private isPageVisible: boolean = true;\n  private isManualMode: boolean = false;\n  \n  private options: Required<InternalOptions>;\n  private scriptReg: RegExp;\n\n  constructor(options: UpdateNotifierOptions = {}) {\n    // 处理 pollingInterval 为 null 或 0 的情况\n    const pollingInterval = options.pollingInterval === null || options.pollingInterval === 0 \n      ? null \n      : (options.pollingInterval || 10000);\n\n    this.isManualMode = pollingInterval === null;\n\n    this.options = {\n      pollingInterval: pollingInterval || 10000,\n      notifyType: options.notifyType || 'confirm',\n      onUpdate: options.onUpdate || null!,\n      onDetected: options.onDetected || (() => {}),\n      pauseOnHidden: options.pauseOnHidden !== false,\n      immediate: options.immediate !== false,\n      indexPath: options.indexPath || '/',\n      scriptRegex: options.scriptRegex || /\\<script.*src=[\"'](?<src>[^\"']+)/gm,\n      debug: options.debug || false,\n      promptMessage: options.promptMessage || '检测到新版本，点击确定将刷新页面并更新'\n    };\n\n    this.scriptReg = this.options.scriptRegex;\n\n    // 仅在自动轮询模式下设置页面可见性监听\n    if (!this.isManualMode && this.options.pauseOnHidden) {\n      this.setupVisibilityListener();\n    }\n\n    // 仅在自动轮询模式下且 immediate 为 true 时自动开始\n    if (!this.isManualMode && this.options.immediate) {\n      this.start();\n    }\n\n    this.log(this.isManualMode ? '手动模式已启用，请使用 checkUpdate() 方法检测更新' : `自动轮询模式已启用，间隔: ${this.options.pollingInterval}ms`);\n  }\n\n  /**\n   * 日志输出\n   */\n  private log(...args: any[]) {\n    if (this.options.debug) {\n      console.log('[VersionUpdateNotifier]', ...args);\n    }\n  }\n\n  /**\n   * 设置页面可见性监听\n   */\n  private setupVisibilityListener() {\n    if (typeof document !== 'undefined') {\n      document.addEventListener('visibilitychange', () => {\n        this.isPageVisible = !document.hidden;\n        this.log('页面可见性变化:', this.isPageVisible ? '可见' : '隐藏');\n        \n        if (this.isPageVisible && !this.timerId) {\n          this.log('页面恢复可见，重新开始检测');\n          this.autoRefresh();\n        }\n      });\n    }\n  }\n\n  /**\n   * 获取最新页面中的 script 链接\n   */\n  private async extractNewScripts(): Promise<string[]> {\n    try {\n      const url = `${this.options.indexPath}?timestamp=${Date.now()}`;\n      this.log('请求URL:', url);\n      \n      const html = await fetch(url).then(res => res.text());\n      this.scriptReg.lastIndex = 0; // 重置正则下标\n      \n      const result: string[] = [];\n      let match: RegExpExecArray | null;\n      \n      while ((match = this.scriptReg.exec(html))) {\n        if (match.groups?.src) {\n          result.push(match.groups.src);\n        }\n      }\n      \n      this.log('提取到的script列表:', result);\n      return result;\n    } catch (error) {\n      console.error('[VersionUpdateNotifier] 获取页面内容失败:', error);\n      return [];\n    }\n  }\n\n  /**\n   * 对比是否有更新\n   */\n  private async needUpdate(): Promise<boolean> {\n    const newScripts = await this.extractNewScripts();\n    \n    if (!this.lastSrcs) {\n      this.lastSrcs = newScripts;\n      this.log('首次记录script列表');\n      return false;\n    }\n\n    let result = false;\n\n    // 数量不同，说明有更新\n    if (this.lastSrcs.length !== newScripts.length) {\n      this.log('script数量变化:', this.lastSrcs.length, '->', newScripts.length);\n      result = true;\n    } else {\n      // 逐个对比\n      for (let i = 0; i < newScripts.length; i++) {\n        if (this.lastSrcs[i] !== newScripts[i]) {\n          this.log('script变化:', this.lastSrcs[i], '->', newScripts[i]);\n          result = true;\n          break;\n        }\n      }\n    }\n\n    this.lastSrcs = newScripts;\n    return result;\n  }\n\n  /**\n   * 自动刷新检测\n   */\n  private async autoRefresh() {\n    // 如果页面不可见且配置了暂停检测，则不执行\n    if (this.options.pauseOnHidden && !this.isPageVisible) {\n      this.log('页面不可见，暂停检测');\n      this.timerId = null;\n      return;\n    }\n\n    this.timerId = window.setTimeout(async () => {\n      const willUpdate = await this.needUpdate();\n      \n      if (willUpdate) {\n        this.log('检测到版本更新');\n        \n        // 触发检测到更新的回调\n        if (this.options.onDetected) {\n          this.options.onDetected();\n        }\n\n        let shouldReload = false;\n\n        // 根据配置的通知类型处理\n        if (this.options.notifyType === 'custom' && this.options.onUpdate) {\n          shouldReload = await this.options.onUpdate();\n        } else {\n          // 默认使用 confirm 提示\n          shouldReload = confirm(this.options.promptMessage);\n        }\n\n        if (shouldReload) {\n          this.log('用户确认刷新，即将重载页面');\n          location.reload();\n          return; // 不再继续轮询\n        } else {\n          this.log('用户取消刷新');\n        }\n      }\n\n      // 继续下一轮检测\n      this.autoRefresh();\n    }, this.options.pollingInterval);\n  }\n\n  /**\n   * 开始检测\n   */\n  public start() {\n    this.log('开始版本更新检测');\n    if (this.timerId) {\n      this.log('检测已在运行中');\n      return;\n    }\n    this.autoRefresh();\n  }\n\n  /**\n   * 停止检测\n   */\n  public stop() {\n    this.log('停止版本更新检测');\n    if (this.timerId) {\n      clearTimeout(this.timerId);\n      this.timerId = null;\n    }\n  }\n\n  /**\n   * 手动触发一次检测（不显示提示，仅返回是否有更新）\n   * @returns 返回是否检测到更新\n   */\n  public async checkNow(): Promise<boolean> {\n    this.log('手动触发检测（静默模式）');\n    return await this.needUpdate();\n  }\n\n  /**\n   * 手动检测并提示用户更新\n   * 适用于完全手动控制的场景，会显示更新提示并根据用户选择刷新页面\n   * @returns 返回是否检测到更新\n   */\n  public async checkUpdate(): Promise<boolean> {\n    this.log('手动检测更新并提示');\n    const hasUpdate = await this.needUpdate();\n    \n    if (hasUpdate) {\n      this.log('检测到版本更新');\n      \n      // 触发检测到更新的回调\n      if (this.options.onDetected) {\n        this.options.onDetected();\n      }\n\n      let shouldReload = false;\n\n      // 根据配置的通知类型处理\n      if (this.options.notifyType === 'custom' && this.options.onUpdate) {\n        shouldReload = await this.options.onUpdate();\n      } else {\n        // 默认使用 confirm 提示\n        shouldReload = confirm(this.options.promptMessage);\n      }\n\n      if (shouldReload) {\n        this.log('用户确认刷新，即将重载页面');\n        location.reload();\n      } else {\n        this.log('用户取消刷新');\n      }\n    }\n    \n    return hasUpdate;\n  }\n\n  /**\n   * 重置状态\n   */\n  public reset() {\n    this.log('重置状态');\n    this.lastSrcs = null;\n    this.stop();\n  }\n}\n\n/**\n * 创建一个版本更新检测器实例\n */\nexport function createUpdateNotifier(options?: UpdateNotifierOptions): VersionUpdateNotifier {\n  return new VersionUpdateNotifier(options);\n}\n\n// 导出类，方便 TypeScript 用户使用类型\nexport { VersionUpdateNotifier };\n\nexport default VersionUpdateNotifier;\n"],"version":3}