{"file":"/Users/Shared/Previously Relocated Items/Security/myProjiect/ai_projet/tests/index.test.ts","mappings":"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","names":[],"sources":["/Users/Shared/Previously Relocated Items/Security/myProjiect/ai_projet/tests/index.test.ts"],"sourcesContent":["import { VersionUpdateNotifier, UpdateNotifierOptions, createUpdateNotifier } from '../src/index';\n\n// 模拟全局浏览器环境\nconst mockBrowserEnvironment = () => {\n  // 创建一个模拟对象来跟踪浏览器API调用\n  const browserCalls = {\n    fetch: [],\n    confirm: [],\n    reload: [],\n    setTimeout: [],\n    clearTimeout: [],\n    addEventListener: []\n  };\n\n  // 模拟fetch函数\n  jest.doMock('undici', () => ({\n    fetch: jest.fn((...args) => {\n      browserCalls.fetch.push(args);\n      return Promise.resolve({\n        text: () => Promise.resolve('<html><script src=\"/test.js\"></script></html>')\n      });\n    })\n  }));\n\n  // 全局变量模拟\n  global.window = {\n    ...global.window,\n    confirm: jest.fn((...args) => {\n      browserCalls.confirm.push(args);\n      return true;\n    })\n  } as any;\n\n  global.document = {\n    ...global.document,\n    addEventListener: jest.fn((...args) => {\n      browserCalls.addEventListener.push(args);\n    }),\n    removeEventListener: jest.fn(),\n    hidden: false\n  } as any;\n\n  global.setTimeout = jest.fn((callback) => {\n    browserCalls.setTimeout.push([callback]);\n    // 立即执行回调以便测试\n    if (typeof callback === 'function') {\n      callback();\n    }\n    return 1;\n  });\n\n  global.clearTimeout = jest.fn((...args) => {\n    browserCalls.clearTimeout.push(args);\n  });\n\n  // 返回跟踪对象\n  return browserCalls;\n};\n\ndescribe('VersionUpdateNotifier 基本功能测试', () => {\n  let browserCalls: ReturnType<typeof mockBrowserEnvironment>;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    browserCalls = mockBrowserEnvironment();\n  });\n\n  test('创建实例时不会抛出错误', () => {\n    expect(() => new VersionUpdateNotifier()).not.toThrow();\n  });\n\n  test('createUpdateNotifier工厂函数返回正确类型', () => {\n    const notifier = createUpdateNotifier();\n    expect(notifier).toBeInstanceOf(VersionUpdateNotifier);\n  });\n\n  test('公共方法存在且可调用', () => {\n    const notifier = new VersionUpdateNotifier({ pollingInterval: 0 });\n    \n    expect(typeof notifier.start).toBe('function');\n    expect(typeof notifier.stop).toBe('function');\n    expect(typeof notifier.reset).toBe('function');\n    expect(typeof notifier.checkNow).toBe('function');\n    expect(typeof notifier.checkUpdate).toBe('function');\n  });\n\n  test('start方法可以正常调用', () => {\n    const notifier = new VersionUpdateNotifier({ pollingInterval: 10000 });\n    expect(() => notifier.start()).not.toThrow();\n  });\n\n  test('stop方法可以正常调用', () => {\n    const notifier = new VersionUpdateNotifier({ pollingInterval: 10000 });\n    notifier.start();\n    expect(() => notifier.stop()).not.toThrow();\n  });\n\n  test('reset方法可以正常调用', () => {\n    const notifier = new VersionUpdateNotifier({ pollingInterval: 10000 });\n    notifier.start();\n    expect(() => notifier.reset()).not.toThrow();\n  });\n\n  test('配置验证正常工作', () => {\n    // 测试无效的notificationType\n    expect(() => {\n      // @ts-ignore\n      new VersionUpdateNotifier({ notificationType: 'invalid' });\n    }).toThrow();\n  });\n});\n\ndescribe('VersionUpdateNotifier 回调测试', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  test('onUpdate回调在更新时被调用', async () => {\n    const onUpdateMock = jest.fn();\n    const notifier = new VersionUpdateNotifier({\n      pollingInterval: 0,\n      notificationType: 'custom',\n      onUpdate: onUpdateMock\n    });\n\n    // 模拟fetch响应\n    const originalFetch = global.fetch;\n    (global as any).fetch = jest.fn().mockResolvedValue({\n      text: () => Promise.resolve('<html><script src=\"/test.js\"></script></html>')\n    });\n\n    // 调用检查方法\n    await notifier.checkNow();\n    \n    // 恢复fetch\n    (global as any).fetch = originalFetch;\n\n    // 验证回调没有被调用（初始检测）\n    expect(onUpdateMock).not.toHaveBeenCalled();\n  });\n\n  test('onDetected回调可以正常工作', async () => {\n    const onDetectedMock = jest.fn();\n    const notifier = new VersionUpdateNotifier({\n      pollingInterval: 0,\n      onDetected: onDetectedMock\n    });\n\n    // 调用检查方法\n    await notifier.checkNow();\n\n    // 验证回调没有被调用（初始检测）\n    expect(onDetectedMock).not.toHaveBeenCalled();\n  });\n});\n\ndescribe('VersionUpdateNotifier 集成测试', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  test('完整的检测流程不会抛出错误', async () => {\n    const notifier = new VersionUpdateNotifier({ pollingInterval: 0 });\n    \n    // 模拟fetch\n    (global as any).fetch = jest.fn().mockResolvedValue({\n      text: () => Promise.resolve('<html><script src=\"/test.js\"></script></html>')\n    });\n\n    // 验证checkNow不会抛出错误\n    await expect(notifier.checkNow()).resolves.not.toThrow();\n  });\n\n  test('使用confirm类型的通知配置', async () => {\n    const notifier = new VersionUpdateNotifier({\n      pollingInterval: 0,\n      notificationType: 'confirm'\n    });\n\n    // 模拟confirm\n    const originalConfirm = window.confirm;\n    (window as any).confirm = jest.fn().mockReturnValue(false);\n\n    // 调用checkUpdate\n    await notifier.checkUpdate();\n\n    // 恢复confirm\n    (window as any).confirm = originalConfirm;\n  });\n});"],"version":3}