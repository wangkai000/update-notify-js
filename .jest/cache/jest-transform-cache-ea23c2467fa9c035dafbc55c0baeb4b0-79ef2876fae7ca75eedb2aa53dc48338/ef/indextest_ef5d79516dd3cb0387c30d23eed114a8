a25aaf07595b7ada105fd0c0ba7657c8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../src/index");
// 模拟全局浏览器环境
const mockBrowserEnvironment = () => {
    // 创建一个模拟对象来跟踪浏览器API调用
    const browserCalls = {
        fetch: [],
        confirm: [],
        reload: [],
        setTimeout: [],
        clearTimeout: [],
        addEventListener: []
    };
    // 模拟fetch函数
    global.fetch = jest.fn((...args) => {
        browserCalls.fetch.push(args);
        return Promise.resolve({
            text: () => Promise.resolve('<html><script src="/test.js"></script></html>')
        });
    });
    // 全局变量模拟
    global.window = {
        ...global.window,
        confirm: jest.fn((...args) => {
            browserCalls.confirm.push(args);
            return true;
        })
    };
    global.document = {
        ...global.document,
        addEventListener: jest.fn((...args) => {
            browserCalls.addEventListener.push(args);
        }),
        removeEventListener: jest.fn(),
        hidden: false
    };
    global.setTimeout = jest.fn((callback) => {
        browserCalls.setTimeout.push([callback]);
        // 立即执行回调以便测试
        if (typeof callback === 'function') {
            callback();
        }
        return 1;
    });
    global.clearTimeout = jest.fn((...args) => {
        browserCalls.clearTimeout.push(args);
    });
    // 返回跟踪对象
    return browserCalls;
};
describe('VersionUpdateNotifier 基本功能测试', () => {
    let browserCalls;
    beforeEach(() => {
        jest.clearAllMocks();
        browserCalls = mockBrowserEnvironment();
    });
    test('创建实例时不会抛出错误', () => {
        expect(() => new index_1.VersionUpdateNotifier()).not.toThrow();
    });
    test('createUpdateNotifier工厂函数返回正确类型', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        expect(notifier).toBeInstanceOf(index_1.VersionUpdateNotifier);
    });
    test('公共方法存在且可调用', () => {
        const notifier = new index_1.VersionUpdateNotifier({ pollingInterval: 0 });
        expect(typeof notifier.start).toBe('function');
        expect(typeof notifier.stop).toBe('function');
        expect(typeof notifier.reset).toBe('function');
        expect(typeof notifier.checkNow).toBe('function');
        expect(typeof notifier.checkUpdate).toBe('function');
    });
    test('start方法可以正常调用', () => {
        const notifier = new index_1.VersionUpdateNotifier({ pollingInterval: 10000 });
        expect(() => notifier.start()).not.toThrow();
    });
    test('stop方法可以正常调用', () => {
        const notifier = new index_1.VersionUpdateNotifier({ pollingInterval: 10000 });
        notifier.start();
        expect(() => notifier.stop()).not.toThrow();
    });
    test('reset方法可以正常调用', () => {
        const notifier = new index_1.VersionUpdateNotifier({ pollingInterval: 10000 });
        notifier.start();
        expect(() => notifier.reset()).not.toThrow();
    });
    test('配置验证正常工作', () => {
        // 测试无效的notificationType
        expect(() => {
            // @ts-ignore
            new index_1.VersionUpdateNotifier({ notificationType: 'invalid' });
        }).toThrow();
    });
});
describe('VersionUpdateNotifier 回调测试', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    test('onUpdate回调在更新时被调用', async () => {
        const onUpdateMock = jest.fn();
        const notifier = new index_1.VersionUpdateNotifier({
            pollingInterval: 0,
            notificationType: 'custom',
            onUpdate: onUpdateMock
        });
        // 模拟fetch响应
        const originalFetch = global.fetch;
        global.fetch = jest.fn().mockResolvedValue({
            text: () => Promise.resolve('<html><script src="/test.js"></script></html>')
        });
        // 调用检查方法
        await notifier.checkNow();
        // 恢复fetch
        global.fetch = originalFetch;
        // 验证回调没有被调用（初始检测）
        expect(onUpdateMock).not.toHaveBeenCalled();
    });
    test('onDetected回调可以正常工作', async () => {
        const onDetectedMock = jest.fn();
        const notifier = new index_1.VersionUpdateNotifier({
            pollingInterval: 0,
            onDetected: onDetectedMock
        });
        // 调用检查方法
        await notifier.checkNow();
        // 验证回调没有被调用（初始检测）
        expect(onDetectedMock).not.toHaveBeenCalled();
    });
});
describe('VersionUpdateNotifier 集成测试', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    test('完整的检测流程不会抛出错误', async () => {
        const notifier = new index_1.VersionUpdateNotifier({ pollingInterval: 0 });
        // 模拟fetch
        global.fetch = jest.fn().mockResolvedValue({
            text: () => Promise.resolve('<html><script src="/test.js"></script></html>')
        });
        // 验证checkNow不会抛出错误
        await expect(notifier.checkNow()).resolves.not.toThrow();
    });
    test('使用confirm类型的通知配置', async () => {
        const notifier = new index_1.VersionUpdateNotifier({
            pollingInterval: 0,
            notificationType: 'confirm'
        });
        // 模拟confirm
        const originalConfirm = window.confirm;
        window.confirm = jest.fn().mockReturnValue(false);
        // 调用checkUpdate
        await notifier.checkUpdate();
        // 恢复confirm
        window.confirm = originalConfirm;
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9pbmRleC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsd0NBQWtHO0FBRWxHLFlBQVk7QUFDWixNQUFNLHNCQUFzQixHQUFHLEdBQUcsRUFBRTtJQUNsQyxzQkFBc0I7SUFDdEIsTUFBTSxZQUFZLEdBQUc7UUFDbkIsS0FBSyxFQUFFLEVBQUU7UUFDVCxPQUFPLEVBQUUsRUFBRTtRQUNYLE1BQU0sRUFBRSxFQUFFO1FBQ1YsVUFBVSxFQUFFLEVBQUU7UUFDZCxZQUFZLEVBQUUsRUFBRTtRQUNoQixnQkFBZ0IsRUFBRSxFQUFFO0tBQ3JCLENBQUM7SUFFRixZQUFZO0lBQ1osTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRTtRQUNqQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUM7WUFDckIsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsK0NBQStDLENBQUM7U0FDN0UsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTO0lBQ1QsTUFBTSxDQUFDLE1BQU0sR0FBRztRQUNkLEdBQUcsTUFBTSxDQUFDLE1BQU07UUFDaEIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFO1lBQzNCLFlBQVksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hDLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDO0tBQ0ksQ0FBQztJQUVULE1BQU0sQ0FBQyxRQUFRLEdBQUc7UUFDaEIsR0FBRyxNQUFNLENBQUMsUUFBUTtRQUNsQixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFB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YSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsZUFBZSxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQy9CLE1BQU0sUUFBUSxHQUFHLElBQUksNkJBQXFCLENBQUMsRUFBRSxlQUFlLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUVuRSxVQUFVO1FBQ1QsTUFBYyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUM7WUFDbEQsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsK0NBQStDLENBQUM7U0FDN0UsQ0FBQyxDQUFDO1FBRUgsbUJBQW1CO1FBQ25CLE1BQU0sTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDM0QsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsa0JBQWtCLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDbEMsTUFBTSxRQUFRLEdBQUcsSUFBSSw2QkFBcUIsQ0FBQztZQUN6QyxlQUFlLEVBQUUsQ0FBQztZQUNsQixnQkFBZ0IsRUFBRSxTQUFTO1NBQzVCLENBQUMsQ0FBQztRQUVILFlBQVk7UUFDWixNQUFNLGVBQWUsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ3RDLE1BQWMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUUzRCxnQkFBZ0I7UUFDaEIsTUFBTSxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFN0IsWUFBWTtRQUNYLE1BQWMsQ0FBQyxPQUFPLEdBQUcsZUFBZSxDQUFDO0lBQzVDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9pbmRleC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZlcnNpb25VcGRhdGVOb3RpZmllciwgVXBkYXRlTm90aWZpZXJPcHRpb25zLCBjcmVhdGVVcGRhdGVOb3RpZmllciB9IGZyb20gJy4uL3NyYy9pbmRleCc7XG5cbi8vIOaooeaLn+WFqOWxgOa1j+iniOWZqOeOr+Wig1xuY29uc3QgbW9ja0Jyb3dzZXJFbnZpcm9ubWVudCA9ICgpID0+IHtcbiAgLy8g5Yib5bu65LiA5Liq5qih5ouf5a+56LGh5p2l6Lef6Liq5rWP6KeI5ZmoQVBJ6LCD55SoXG4gIGNvbnN0IGJyb3dzZXJDYWxscyA9IHtcbiAgICBmZXRjaDogW10sXG4gICAgY29uZmlybTogW10sXG4gICAgcmVsb2FkOiBbXSxcbiAgICBzZXRUaW1lb3V0OiBbXSxcbiAgICBjbGVhclRpbWVvdXQ6IFtdLFxuICAgIGFkZEV2ZW50TGlzdGVuZXI6IFtdXG4gIH07XG5cbiAgLy8g5qih5oufZmV0Y2jlh73mlbBcbiAgZ2xvYmFsLmZldGNoID0gamVzdC5mbigoLi4uYXJncykgPT4ge1xuICAgIGJyb3dzZXJDYWxscy5mZXRjaC5wdXNoKGFyZ3MpO1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgdGV4dDogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIOWFqOWxgOWPmOmHj+aooeaLn1xuICBnbG9iYWwud2luZG93ID0ge1xuICAgIC4uLmdsb2JhbC53aW5kb3csXG4gICAgY29uZmlybTogamVzdC5mbigoLi4uYXJncykgPT4ge1xuICAgICAgYnJvd3NlckNhbGxzLmNvbmZpcm0ucHVzaChhcmdzKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pXG4gIH0gYXMgYW55O1xuXG4gIGdsb2JhbC5kb2N1bWVudCA9IHtcbiAgICAuLi5nbG9iYWwuZG9jdW1lbnQsXG4gICAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigoLi4uYXJncykgPT4ge1xuICAgICAgYnJvd3NlckNhbGxzLmFkZEV2ZW50TGlzdGVuZXIucHVzaChhcmdzKTtcbiAgICB9KSxcbiAgICByZW1vdmVFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgaGlkZGVuOiBmYWxzZVxuICB9IGFzIGFueTtcblxuICBnbG9iYWwuc2V0VGltZW91dCA9IGplc3QuZm4oKGNhbGxiYWNrKSA9PiB7XG4gICAgYnJvd3NlckNhbGxzLnNldFRpbWVvdXQucHVzaChbY2FsbGJhY2tdKTtcbiAgICAvLyDnq4vljbPmiafooYzlm57osIPku6Xkvr/mtYvor5VcbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgICByZXR1cm4gMTtcbiAgfSk7XG5cbiAgZ2xvYmFsLmNsZWFyVGltZW91dCA9IGplc3QuZm4oKC4uLmFyZ3MpID0+IHtcbiAgICBicm93c2VyQ2FsbHMuY2xlYXJUaW1lb3V0LnB1c2goYXJncyk7XG4gIH0pO1xuXG4gIC8vIOi/lOWbnui3n+i4quWvueixoVxuICByZXR1cm4gYnJvd3NlckNhbGxzO1xufTtcblxuZGVzY3JpYmUoJ1ZlcnNpb25VcGRhdGVOb3RpZmllciDln7rmnKzlip/og73mtYvor5UnLCAoKSA9PiB7XG4gIGxldCBicm93c2VyQ2FsbHM6IFJldHVyblR5cGU8dHlwZW9mIG1vY2tCcm93c2VyRW52aXJvbm1lbnQ+O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIGJyb3dzZXJDYWxscyA9IG1vY2tCcm93c2VyRW52aXJvbm1lbnQoKTtcbiAgfSk7XG5cbiAgdGVzdCgn5Yib5bu65a6e5L6L5pe25LiN5Lya5oqb5Ye66ZSZ6K+vJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgVmVyc2lvblVwZGF0ZU5vdGlmaWVyKCkpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NyZWF0ZVVwZGF0ZU5vdGlmaWVy5bel5Y6C5Ye95pWw6L+U5Zue5q2j56Gu57G75Z6LJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoKTtcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVJbnN0YW5jZU9mKFZlcnNpb25VcGRhdGVOb3RpZmllcik7XG4gIH0pO1xuXG4gIHRlc3QoJ+WFrOWFseaWueazleWtmOWcqOS4lOWPr+iwg+eUqCcsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IG5ldyBWZXJzaW9uVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IDAgfSk7XG4gICAgXG4gICAgZXhwZWN0KHR5cGVvZiBub3RpZmllci5zdGFydCkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICBleHBlY3QodHlwZW9mIG5vdGlmaWVyLnN0b3ApLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgZXhwZWN0KHR5cGVvZiBub3RpZmllci5yZXNldCkudG9CZSgnZnVuY3Rpb24nKTtcbiAgICBleHBlY3QodHlwZW9mIG5vdGlmaWVyLmNoZWNrTm93KS50b0JlKCdmdW5jdGlvbicpO1xuICAgIGV4cGVjdCh0eXBlb2Ygbm90aWZpZXIuY2hlY2tVcGRhdGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3N0YXJ05pa55rOV5Y+v5Lul5q2j5bi46LCD55SoJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gbmV3IFZlcnNpb25VcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogMTAwMDAgfSk7XG4gICAgZXhwZWN0KCgpID0+IG5vdGlmaWVyLnN0YXJ0KCkpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3N0b3Dmlrnms5Xlj6/ku6XmraPluLjosIPnlKgnLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBuZXcgVmVyc2lvblVwZGF0ZU5vdGlmaWVyKHsgcG9sbGluZ0ludGVydmFsOiAxMDAwMCB9KTtcbiAgICBub3RpZmllci5zdGFydCgpO1xuICAgIGV4cGVjdCgoKSA9PiBub3RpZmllci5zdG9wKCkpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Jlc2V05pa55rOV5Y+v5Lul5q2j5bi46LCD55SoJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gbmV3IFZlcnNpb25VcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogMTAwMDAgfSk7XG4gICAgbm90aWZpZXIuc3RhcnQoKTtcbiAgICBleHBlY3QoKCkgPT4gbm90aWZpZXIucmVzZXQoKSkubm90LnRvVGhyb3coKTtcbiAgfSk7XG5cbiAgdGVzdCgn6YWN572u6aqM6K+B5q2j5bi45bel5L2cJywgKCkgPT4ge1xuICAgIC8vIOa1i+ivleaXoOaViOeahG5vdGlmaWNhdGlvblR5cGVcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgbmV3IFZlcnNpb25VcGRhdGVOb3RpZmllcih7IG5vdGlmaWNhdGlvblR5cGU6ICdpbnZhbGlkJyB9KTtcbiAgICB9KS50b1Rocm93KCk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdWZXJzaW9uVXBkYXRlTm90aWZpZXIg5Zue6LCD5rWL6K+VJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgdGVzdCgnb25VcGRhdGXlm57osIPlnKjmm7TmlrDml7booqvosIPnlKgnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgb25VcGRhdGVNb2NrID0gamVzdC5mbigpO1xuICAgIGNvbnN0IG5vdGlmaWVyID0gbmV3IFZlcnNpb25VcGRhdGVOb3RpZmllcih7XG4gICAgICBwb2xsaW5nSW50ZXJ2YWw6IDAsXG4gICAgICBub3RpZmljYXRpb25UeXBlOiAnY3VzdG9tJyxcbiAgICAgIG9uVXBkYXRlOiBvblVwZGF0ZU1vY2tcbiAgICB9KTtcblxuICAgIC8vIOaooeaLn2ZldGNo5ZON5bqUXG4gICAgY29uc3Qgb3JpZ2luYWxGZXRjaCA9IGdsb2JhbC5mZXRjaDtcbiAgICAoZ2xvYmFsIGFzIGFueSkuZmV0Y2ggPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG5cbiAgICAvLyDosIPnlKjmo4Dmn6Xmlrnms5VcbiAgICBhd2FpdCBub3RpZmllci5jaGVja05vdygpO1xuICAgIFxuICAgIC8vIOaBouWkjWZldGNoXG4gICAgKGdsb2JhbCBhcyBhbnkpLmZldGNoID0gb3JpZ2luYWxGZXRjaDtcblxuICAgIC8vIOmqjOivgeWbnuiwg+ayoeacieiiq+iwg+eUqO+8iOWIneWni+ajgOa1i++8iVxuICAgIGV4cGVjdChvblVwZGF0ZU1vY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ29uRGV0ZWN0ZWTlm57osIPlj6/ku6XmraPluLjlt6XkvZwnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgb25EZXRlY3RlZE1vY2sgPSBqZXN0LmZuKCk7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBuZXcgVmVyc2lvblVwZGF0ZU5vdGlmaWVyKHtcbiAgICAgIHBvbGxpbmdJbnRlcnZhbDogMCxcbiAgICAgIG9uRGV0ZWN0ZWQ6IG9uRGV0ZWN0ZWRNb2NrXG4gICAgfSk7XG5cbiAgICAvLyDosIPnlKjmo4Dmn6Xmlrnms5VcbiAgICBhd2FpdCBub3RpZmllci5jaGVja05vdygpO1xuXG4gICAgLy8g6aqM6K+B5Zue6LCD5rKh5pyJ6KKr6LCD55So77yI5Yid5aeL5qOA5rWL77yJXG4gICAgZXhwZWN0KG9uRGV0ZWN0ZWRNb2NrKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnVmVyc2lvblVwZGF0ZU5vdGlmaWVyIOmbhuaIkOa1i+ivlScsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ+WujOaVtOeahOajgOa1i+a1geeoi+S4jeS8muaKm+WHuumUmeivrycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IG5ldyBWZXJzaW9uVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IDAgfSk7XG4gICAgXG4gICAgLy8g5qih5oufZmV0Y2hcbiAgICAoZ2xvYmFsIGFzIGFueSkuZmV0Y2ggPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG5cbiAgICAvLyDpqozor4FjaGVja05vd+S4jeS8muaKm+WHuumUmeivr1xuICAgIGF3YWl0IGV4cGVjdChub3RpZmllci5jaGVja05vdygpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICB9KTtcblxuICB0ZXN0KCfkvb/nlKhjb25maXJt57G75Z6L55qE6YCa55+l6YWN572uJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gbmV3IFZlcnNpb25VcGRhdGVOb3RpZmllcih7XG4gICAgICBwb2xsaW5nSW50ZXJ2YWw6IDAsXG4gICAgICBub3RpZmljYXRpb25UeXBlOiAnY29uZmlybSdcbiAgICB9KTtcblxuICAgIC8vIOaooeaLn2NvbmZpcm1cbiAgICBjb25zdCBvcmlnaW5hbENvbmZpcm0gPSB3aW5kb3cuY29uZmlybTtcbiAgICAod2luZG93IGFzIGFueSkuY29uZmlybSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuXG4gICAgLy8g6LCD55SoY2hlY2tVcGRhdGVcbiAgICBhd2FpdCBub3RpZmllci5jaGVja1VwZGF0ZSgpO1xuXG4gICAgLy8g5oGi5aSNY29uZmlybVxuICAgICh3aW5kb3cgYXMgYW55KS5jb25maXJtID0gb3JpZ2luYWxDb25maXJtO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==