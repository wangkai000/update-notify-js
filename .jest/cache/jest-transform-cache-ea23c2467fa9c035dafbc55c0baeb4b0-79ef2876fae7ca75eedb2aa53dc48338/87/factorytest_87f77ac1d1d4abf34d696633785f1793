6e52fe894eb4a4b868e33269d273d82e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../src/index");
describe('工厂函数测试', () => {
    beforeEach(() => {
        // 重置所有模拟
        jest.clearAllMocks();
        // 保存并模拟全局对象
        jest.spyOn(window, 'setTimeout').mockImplementation(() => 1);
        jest.spyOn(window, 'clearTimeout').mockImplementation(() => { });
    });
    afterEach(() => {
        // 恢复原始方法
        jest.restoreAllMocks();
    });
    test('createUpdateNotifier使用null作为pollingInterval', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: null });
        expect(notifier).toBeDefined();
        // 在null模式下不应该启动自动轮询
        expect(setTimeout).not.toHaveBeenCalled();
    });
    test('createUpdateNotifier配置不同的轮询间隔', () => {
        const customInterval = 30000;
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: customInterval });
        expect(notifier).toBeDefined();
        expect(setTimeout).toHaveBeenCalled();
    });
    test('createUpdateNotifier配置自定义indexPath', () => {
        const customPath = '/custom-index.html';
        const notifier = (0, index_1.createUpdateNotifier)({ indexPath: customPath });
        expect(notifier).toBeDefined();
    });
    test('createUpdateNotifier配置自定义scriptRegex', () => {
        const customRegex = /<script.*src=["'](?<src>[^"']+)/gm;
        const notifier = (0, index_1.createUpdateNotifier)({ scriptRegex: customRegex });
        expect(notifier).toBeDefined();
    });
    test('createUpdateNotifier配置自定义提示消息', () => {
        const customMessage = '新版本已发布，是否立即更新？';
        const notifier = (0, index_1.createUpdateNotifier)({ promptMessage: customMessage });
        expect(notifier).toBeDefined();
    });
    test('createUpdateNotifier设置immediate为false', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ immediate: false });
        expect(notifier).toBeDefined();
        // immediate为false时不应立即启动轮询
        expect(setTimeout).not.toHaveBeenCalled();
    });
    test('createUpdateNotifier设置pauseOnHidden为false', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pauseOnHidden: false });
        expect(notifier).toBeDefined();
        // 检查是否没有添加visibilitychange事件监听器
        expect(document.addEventListener).not.toHaveBeenCalledWith('visibilitychange', expect.any(Function));
    });
});
describe('边界情况测试', () => {
    beforeEach(() => {
        jest.spyOn(window, 'setTimeout').mockImplementation(() => 1);
        jest.spyOn(window, 'clearTimeout').mockImplementation(() => { });
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
    test('重复调用start方法', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        // 第一次调用start
        jest.clearAllMocks();
        notifier.start();
        // 第二次调用start
        const secondCall = () => notifier.start();
        expect(secondCall).not.toThrow();
    });
    test('重复调用stop方法', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        // 第一次调用stop
        notifier.stop();
        // 第二次调用stop
        const secondCall = () => notifier.stop();
        expect(secondCall).not.toThrow();
    });
    test('stop后再start', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        notifier.stop();
        jest.clearAllMocks();
        notifier.start();
        expect(setTimeout).toHaveBeenCalled();
    });
    test('设置非常大的轮询间隔', () => {
        const veryLargeInterval = Number.MAX_SAFE_INTEGER;
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: veryLargeInterval });
        expect(notifier).toBeDefined();
    });
    test('设置为负数的轮询间隔（应使用默认值）', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: -1000 });
        expect(notifier).toBeDefined();
        expect(setTimeout).toHaveBeenCalled();
    });
});
describe('异步回调测试', () => {
    let notifier;
    let originalFetch;
    beforeEach(() => {
        // 保存原始方法
        originalFetch = globalThis.fetch;
        // 安全地模拟fetch，确保它在全局对象上存在
        globalThis.fetch = jest.fn();
        jest.spyOn(window, 'setTimeout').mockImplementation(() => 1);
        jest.spyOn(window, 'clearTimeout').mockImplementation(() => { });
        // 模拟confirm
        jest.spyOn(window, 'confirm').mockImplementation(() => false);
        // 安全地模拟location.reload，避免直接修改只读属性
        try {
            jest.spyOn(window.location, 'reload').mockImplementation(() => { });
        }
        catch (e) {
            // 如果无法spyOn，则创建一个替代方法
            window.location.__originalReload = window.location.reload;
            window.location.reload = jest.fn();
        }
    });
    afterEach(() => {
        // 恢复原始方法
        if (originalFetch) {
            globalThis.fetch = originalFetch;
        }
        else {
            delete globalThis.fetch;
        }
        // 恢复location.reload
        if (window.location.__originalReload) {
            window.location.reload = window.location.__originalReload;
            delete window.location.__originalReload;
        }
        jest.restoreAllMocks();
    });
    test('异步onUpdate回调返回true', async () => {
        const mockOnUpdate = jest.fn().mockResolvedValue(true);
        // 模拟fetch返回的HTML内容，以便能检测到更新
        globalThis.fetch.mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.123.js"></script></html>')
        });
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 0,
            notifyType: 'custom',
            onUpdate: mockOnUpdate
        });
        // 模拟location.reload
        const reloadSpy = jest.spyOn(window.location, 'reload').mockImplementation(() => { });
        // 第一次调用不会触发更新（初始化）
        await notifier.checkNow();
        // 模拟新的script内容
        jest.spyOn(globalThis, 'fetch').mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.456.js"></script></html>')
        });
        await notifier.checkUpdate();
        expect(mockOnUpdate).toHaveBeenCalled();
    });
    test('异步onUpdate回调返回false', async () => {
        const mockOnUpdate = jest.fn().mockResolvedValue(false);
        // 模拟fetch返回的HTML内容，以便能检测到更新
        globalThis.fetch.mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.123.js"></script></html>')
        });
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 0,
            notifyType: 'custom',
            onUpdate: mockOnUpdate
        });
        // 模拟location.reload
        const reloadSpy = jest.spyOn(window.location, 'reload').mockImplementation(() => { });
        // 第一次调用不会触发更新（初始化）
        await notifier.checkNow();
        // 模拟新的script内容
        jest.spyOn(globalThis, 'fetch').mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.456.js"></script></html>')
        });
        await notifier.checkUpdate();
        expect(mockOnUpdate).toHaveBeenCalled();
        expect(reloadSpy).not.toHaveBeenCalled();
    });
    test('onDetected回调被正确调用', async () => {
        const mockOnDetected = jest.fn();
        // 模拟fetch返回的HTML内容，以便能检测到更新
        globalThis.fetch.mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.123.js"></script></html>')
        });
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 0,
            onDetected: mockOnDetected
        });
        // 第一次调用不会触发更新（初始化）
        await notifier.checkNow();
        // 模拟新的script内容
        jest.spyOn(globalThis, 'fetch').mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.456.js"></script></html>')
        });
        await notifier.checkUpdate();
        expect(mockOnDetected).toHaveBeenCalled();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9mYWN0b3J5LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FBb0Q7QUFFcEQsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7SUFDdEIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFNBQVM7UUFDVCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsWUFBWTtRQUNaLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLFlBQVksQ0FBQyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2xFLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLFNBQVM7UUFDVCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsNkNBQTZDLEVBQUUsR0FBRyxFQUFFO1FBQ3ZELE1BQU0sUUFBUSxHQUFHLElBQUEsNEJBQW9CLEVBQUMsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUVqRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDL0Isb0JBQW9CO1FBQ3BCLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUM1QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDekMsTUFBTSxjQUFjLEdBQUcsS0FBSyxDQUFDO1FBQzdCLE1BQU0sUUFBUSxHQUFHLElBQUEsNEJBQW9CLEVBQUMsRUFBRSxlQUFlLEVB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QztZQUNoRCxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLG1EQUFtRCxDQUFDO1NBQ3ZGLENBQUMsQ0FBQztRQUVILE1BQU0sUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRTdCLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzVDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9mYWN0b3J5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlVXBkYXRlTm90aWZpZXIgfSBmcm9tICcuLi9zcmMvaW5kZXgnO1xuXG5kZXNjcmliZSgn5bel5Y6C5Ye95pWw5rWL6K+VJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyDph43nva7miYDmnInmqKHmi59cbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBcbiAgICAvLyDkv53lrZjlubbmqKHmi5/lhajlsYDlr7nosaFcbiAgICBqZXN0LnNweU9uKHdpbmRvdywgJ3NldFRpbWVvdXQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gMSk7XG4gICAgamVzdC5zcHlPbih3aW5kb3csICdjbGVhclRpbWVvdXQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICB9KTtcbiAgXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgLy8g5oGi5aSN5Y6f5aeL5pa55rOVXG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdjcmVhdGVVcGRhdGVOb3RpZmllcuS9v+eUqG51bGzkvZzkuLpwb2xsaW5nSW50ZXJ2YWwnLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogbnVsbCB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgLy8g5ZyobnVsbOaooeW8j+S4i+S4jeW6lOivpeWQr+WKqOiHquWKqOi9ruivolxuICAgIGV4cGVjdChzZXRUaW1lb3V0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ2NyZWF0ZVVwZGF0ZU5vdGlmaWVy6YWN572u5LiN5ZCM55qE6L2u6K+i6Ze06ZqUJywgKCkgPT4ge1xuICAgIGNvbnN0IGN1c3RvbUludGVydmFsID0gMzAwMDA7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogY3VzdG9tSW50ZXJ2YWwgfSk7XG4gICAgXG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChzZXRUaW1lb3V0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgnY3JlYXRlVXBkYXRlTm90aWZpZXLphY3nva7oh6rlrprkuYlpbmRleFBhdGgnLCAoKSA9PiB7XG4gICAgY29uc3QgY3VzdG9tUGF0aCA9ICcvY3VzdG9tLWluZGV4Lmh0bWwnO1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBpbmRleFBhdGg6IGN1c3RvbVBhdGggfSk7XG4gICAgXG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ2NyZWF0ZVVwZGF0ZU5vdGlmaWVy6YWN572u6Ieq5a6a5LmJc2NyaXB0UmVnZXgnLCAoKSA9PiB7XG4gICAgY29uc3QgY3VzdG9tUmVnZXggPSAvPHNjcmlwdC4qc3JjPVtcIiddKD88c3JjPlteXCInXSspL2dtO1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBzY3JpcHRSZWdleDogY3VzdG9tUmVnZXggfSk7XG4gICAgXG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ2NyZWF0ZVVwZGF0ZU5vdGlmaWVy6YWN572u6Ieq5a6a5LmJ5o+Q56S65raI5oGvJywgKCkgPT4ge1xuICAgIGNvbnN0IGN1c3RvbU1lc3NhZ2UgPSAn5paw54mI5pys5bey5Y+R5biD77yM5piv5ZCm56uL5Y2z5pu05paw77yfJztcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgcHJvbXB0TWVzc2FnZTogY3VzdG9tTWVzc2FnZSB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgnY3JlYXRlVXBkYXRlTm90aWZpZXLorr7nva5pbW1lZGlhdGXkuLpmYWxzZScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgaW1tZWRpYXRlOiBmYWxzZSB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgLy8gaW1tZWRpYXRl5Li6ZmFsc2Xml7bkuI3lupTnq4vljbPlkK/liqjova7or6JcbiAgICBleHBlY3Qoc2V0VGltZW91dCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdjcmVhdGVVcGRhdGVOb3RpZmllcuiuvue9rnBhdXNlT25IaWRkZW7kuLpmYWxzZScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgcGF1c2VPbkhpZGRlbjogZmFsc2UgfSk7XG4gICAgXG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICAgIC8vIOajgOafpeaYr+WQpuayoeaciea3u+WKoHZpc2liaWxpdHljaGFuZ2Xkuovku7bnm5HlkKzlmahcbiAgICBleHBlY3QoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikubm90LnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd2aXNpYmlsaXR5Y2hhbmdlJywgZXhwZWN0LmFueShGdW5jdGlvbikpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgn6L6555WM5oOF5Ya15rWL6K+VJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LnNweU9uKHdpbmRvdywgJ3NldFRpbWVvdXQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gMSk7XG4gICAgamVzdC5zcHlPbih3aW5kb3csICdjbGVhclRpbWVvdXQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICB9KTtcbiAgXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCfph43lpI3osIPnlKhzdGFydOaWueazlScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKCk7XG4gICAgXG4gICAgLy8g56ys5LiA5qyh6LCD55Soc3RhcnRcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBub3RpZmllci5zdGFydCgpO1xuICAgIFxuICAgIC8vIOesrOS6jOasoeiwg+eUqHN0YXJ0XG4gICAgY29uc3Qgc2Vjb25kQ2FsbCA9ICgpID0+IG5vdGlmaWVyLnN0YXJ0KCk7XG4gICAgZXhwZWN0KHNlY29uZENhbGwpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuICBcbiAgdGVzdCgn6YeN5aSN6LCD55Soc3RvcOaWueazlScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKCk7XG4gICAgXG4gICAgLy8g56ys5LiA5qyh6LCD55Soc3RvcFxuICAgIG5vdGlmaWVyLnN0b3AoKTtcbiAgICBcbiAgICAvLyDnrKzkuozmrKHosIPnlKhzdG9wXG4gICAgY29uc3Qgc2Vjb25kQ2FsbCA9ICgpID0+IG5vdGlmaWVyLnN0b3AoKTtcbiAgICBleHBlY3Qoc2Vjb25kQ2FsbCkubm90LnRvVGhyb3coKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdzdG9w5ZCO5YaNc3RhcnQnLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcigpO1xuICAgIFxuICAgIG5vdGlmaWVyLnN0b3AoKTtcbiAgICBcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBub3RpZmllci5zdGFydCgpO1xuICAgIFxuICAgIGV4cGVjdChzZXRUaW1lb3V0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgn6K6+572u6Z2e5bi45aSn55qE6L2u6K+i6Ze06ZqUJywgKCkgPT4ge1xuICAgIGNvbnN0IHZlcnlMYXJnZUludGVydmFsID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogdmVyeUxhcmdlSW50ZXJ2YWwgfSk7XG4gICAgXG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ+iuvue9ruS4uui0n+aVsOeahOi9ruivoumXtOmalO+8iOW6lOS9v+eUqOm7mOiupOWAvO+8iScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgcG9sbGluZ0ludGVydmFsOiAtMTAwMCB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KHNldFRpbWVvdXQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ+W8guatpeWbnuiwg+a1i+ivlScsICgpID0+IHtcbiAgbGV0IG5vdGlmaWVyOiBhbnk7XG4gIFxuICBsZXQgb3JpZ2luYWxGZXRjaDogdHlwZW9mIGZldGNoO1xuICBcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgLy8g5L+d5a2Y5Y6f5aeL5pa55rOVXG4gICAgb3JpZ2luYWxGZXRjaCA9IChnbG9iYWxUaGlzIGFzIGFueSkuZmV0Y2g7XG4gICAgXG4gICAgLy8g5a6J5YWo5Zyw5qih5oufZmV0Y2jvvIznoa7kv53lroPlnKjlhajlsYDlr7nosaHkuIrlrZjlnKhcbiAgICAoZ2xvYmFsVGhpcyBhcyBhbnkpLmZldGNoID0gamVzdC5mbigpO1xuICAgIFxuICAgIGplc3Quc3B5T24od2luZG93LCAnc2V0VGltZW91dCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAxKTtcbiAgICBqZXN0LnNweU9uKHdpbmRvdywgJ2NsZWFyVGltZW91dCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgXG4gICAgLy8g5qih5oufY29uZmlybVxuICAgIGplc3Quc3B5T24od2luZG93LCAnY29uZmlybScpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBmYWxzZSk7XG4gICAgXG4gICAgLy8g5a6J5YWo5Zyw5qih5oufbG9jYXRpb24ucmVsb2Fk77yM6YG/5YWN55u05o6l5L+u5pS55Y+q6K+75bGe5oCnXG4gICAgdHJ5IHtcbiAgICAgIGplc3Quc3B5T24od2luZG93LmxvY2F0aW9uLCAncmVsb2FkJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyDlpoLmnpzml6Dms5VzcHlPbu+8jOWImeWIm+W7uuS4gOS4quabv+S7o+aWueazlVxuICAgICAgKHdpbmRvdy5sb2NhdGlvbiBhcyBhbnkpLl9fb3JpZ2luYWxSZWxvYWQgPSB3aW5kb3cubG9jYXRpb24ucmVsb2FkO1xuICAgICAgKHdpbmRvdy5sb2NhdGlvbiBhcyBhbnkpLnJlbG9hZCA9IGplc3QuZm4oKTtcbiAgICB9XG4gIH0pO1xuICBcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAvLyDmgaLlpI3ljp/lp4vmlrnms5VcbiAgICBpZiAob3JpZ2luYWxGZXRjaCkge1xuICAgICAgKGdsb2JhbFRoaXMgYXMgYW55KS5mZXRjaCA9IG9yaWdpbmFsRmV0Y2g7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZSAoZ2xvYmFsVGhpcyBhcyBhbnkpLmZldGNoO1xuICAgIH1cbiAgICBcbiAgICAvLyDmgaLlpI1sb2NhdGlvbi5yZWxvYWRcbiAgICBpZiAoKHdpbmRvdy5sb2NhdGlvbiBhcyBhbnkpLl9fb3JpZ2luYWxSZWxvYWQpIHtcbiAgICAgICh3aW5kb3cubG9jYXRpb24gYXMgYW55KS5yZWxvYWQgPSAod2luZG93LmxvY2F0aW9uIGFzIGFueSkuX19vcmlnaW5hbFJlbG9hZDtcbiAgICAgIGRlbGV0ZSAod2luZG93LmxvY2F0aW9uIGFzIGFueSkuX19vcmlnaW5hbFJlbG9hZDtcbiAgICB9XG4gICAgXG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCflvILmraVvblVwZGF0ZeWbnuiwg+i/lOWbnnRydWUnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja09uVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgIFxuICAgIC8vIOaooeaLn2ZldGNo6L+U5Zue55qESFRNTOWGheWuue+8jOS7peS+v+iDveajgOa1i+WIsOabtOaWsFxuICAgIChnbG9iYWxUaGlzLmZldGNoIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LjEyMy5qc1wiPjwvc2NyaXB0PjwvaHRtbD4nKVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoe1xuICAgICAgcG9sbGluZ0ludGVydmFsOiAwLFxuICAgICAgbm90aWZ5VHlwZTogJ2N1c3RvbScsXG4gICAgICBvblVwZGF0ZTogbW9ja09uVXBkYXRlXG4gICAgfSk7XG4gICAgXG4gICAgLy8g5qih5oufbG9jYXRpb24ucmVsb2FkXG4gICAgY29uc3QgcmVsb2FkU3B5ID0gamVzdC5zcHlPbih3aW5kb3cubG9jYXRpb24sICdyZWxvYWQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgIFxuICAgIC8vIOesrOS4gOasoeiwg+eUqOS4jeS8muinpuWPkeabtOaWsO+8iOWIneWni+WMlu+8iVxuICAgIGF3YWl0IG5vdGlmaWVyLmNoZWNrTm93KCk7XG4gICAgXG4gICAgLy8g5qih5ouf5paw55qEc2NyaXB05YaF5a65XG4gICAgamVzdC5zcHlPbihnbG9iYWxUaGlzLCAnZmV0Y2gnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuNDU2LmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgbm90aWZpZXIuY2hlY2tVcGRhdGUoKTtcbiAgICBcbiAgICBleHBlY3QobW9ja09uVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgn5byC5q2lb25VcGRhdGXlm57osIPov5Tlm55mYWxzZScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2NrT25VcGRhdGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgIFxuICAgIC8vIOaooeaLn2ZldGNo6L+U5Zue55qESFRNTOWGheWuue+8jOS7peS+v+iDveajgOa1i+WIsOabtOaWsFxuICAgIChnbG9iYWxUaGlzLmZldGNoIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LjEyMy5qc1wiPjwvc2NyaXB0PjwvaHRtbD4nKVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoe1xuICAgICAgcG9sbGluZ0ludGVydmFsOiAwLFxuICAgICAgbm90aWZ5VHlwZTogJ2N1c3RvbScsXG4gICAgICBvblVwZGF0ZTogbW9ja09uVXBkYXRlXG4gICAgfSk7XG4gICAgXG4gICAgLy8g5qih5oufbG9jYXRpb24ucmVsb2FkXG4gICAgY29uc3QgcmVsb2FkU3B5ID0gamVzdC5zcHlPbih3aW5kb3cubG9jYXRpb24sICdyZWxvYWQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgIFxuICAgIC8vIOesrOS4gOasoeiwg+eUqOS4jeS8muinpuWPkeabtOaWsO+8iOWIneWni+WMlu+8iVxuICAgIGF3YWl0IG5vdGlmaWVyLmNoZWNrTm93KCk7XG4gICAgXG4gICAgLy8g5qih5ouf5paw55qEc2NyaXB05YaF5a65XG4gICAgamVzdC5zcHlPbihnbG9iYWxUaGlzLCAnZmV0Y2gnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuNDU2LmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgbm90aWZpZXIuY2hlY2tVcGRhdGUoKTtcbiAgICBcbiAgICBleHBlY3QobW9ja09uVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgZXhwZWN0KHJlbG9hZFNweSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdvbkRldGVjdGVk5Zue6LCD6KKr5q2j56Gu6LCD55SoJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tPbkRldGVjdGVkID0gamVzdC5mbigpO1xuICAgIFxuICAgIC8vIOaooeaLn2ZldGNo6L+U5Zue55qESFRNTOWGheWuue+8jOS7peS+v+iDveajgOa1i+WIsOabtOaWsFxuICAgIChnbG9iYWxUaGlzLmZldGNoIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LjEyMy5qc1wiPjwvc2NyaXB0PjwvaHRtbD4nKVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoe1xuICAgICAgcG9sbGluZ0ludGVydmFsOiAwLFxuICAgICAgb25EZXRlY3RlZDogbW9ja09uRGV0ZWN0ZWRcbiAgICB9KTtcbiAgICBcbiAgICAvLyDnrKzkuIDmrKHosIPnlKjkuI3kvJrop6blj5Hmm7TmlrDvvIjliJ3lp4vljJbvvIlcbiAgICBhd2FpdCBub3RpZmllci5jaGVja05vdygpO1xuICAgIFxuICAgIC8vIOaooeaLn+aWsOeahHNjcmlwdOWGheWuuVxuICAgIGplc3Quc3B5T24oZ2xvYmFsVGhpcywgJ2ZldGNoJykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LjQ1Ni5qc1wiPjwvc2NyaXB0PjwvaHRtbD4nKVxuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IG5vdGlmaWVyLmNoZWNrVXBkYXRlKCk7XG4gICAgXG4gICAgZXhwZWN0KG1vY2tPbkRldGVjdGVkKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9