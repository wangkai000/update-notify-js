92b1ca91641a26556e1b5ca654c2326a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../src/index");
// 使用安全的浏览器API模拟策略
const mockBrowserAPI = () => {
    const mocks = {
        confirm: jest.fn(),
        setTimeout: jest.fn((cb) => cb()),
        clearTimeout: jest.fn(),
        fetch: jest.fn(),
        location: {
            reload: jest.fn()
        },
        document: {
            addEventListener: jest.fn(),
            removeEventListener: jest.fn(),
            hidden: false
        }
    };
    // 保存原始方法
    const originalConfirm = window.confirm;
    const originalSetTimeout = window.setTimeout;
    const originalClearTimeout = window.clearTimeout;
    const originalFetch = globalThis.fetch;
    const originalAddEventListener = document.addEventListener;
    const originalRemoveEventListener = document.removeEventListener;
    const originalHidden = Object.getOwnPropertyDescriptor(document, 'hidden');
    const originalReload = Function.prototype.call.bind(window.location.reload);
    // 应用模拟
    Object.defineProperty(window, 'confirm', { value: mocks.confirm });
    Object.defineProperty(window, 'setTimeout', { value: mocks.setTimeout });
    Object.defineProperty(window, 'clearTimeout', { value: mocks.clearTimeout });
    globalThis.fetch = mocks.fetch;
    Object.defineProperty(document, 'addEventListener', { value: mocks.document.addEventListener });
    Object.defineProperty(document, 'removeEventListener', { value: mocks.document.removeEventListener });
    Object.defineProperty(document, 'hidden', {
        get: () => mocks.document.hidden,
        set: (value) => { mocks.document.hidden = value; },
        configurable: true
    });
    // 模拟location.reload而不尝试修改只读属性
    Object.defineProperty(window.location, 'reload', {
        value: function () {
            mocks.location.reload();
            return originalReload(this);
        },
        configurable: true
    });
    // 返回重置函数和模拟对象
    return {
        mocks,
        reset: () => {
            // 恢复原始方法
            Object.defineProperty(window, 'confirm', { value: originalConfirm });
            Object.defineProperty(window, 'setTimeout', { value: originalSetTimeout });
            Object.defineProperty(window, 'clearTimeout', { value: originalClearTimeout });
            globalThis.fetch = originalFetch;
            Object.defineProperty(document, 'addEventListener', { value: originalAddEventListener });
            Object.defineProperty(document, 'removeEventListener', { value: originalRemoveEventListener });
            if (originalHidden) {
                Object.defineProperty(document, 'hidden', originalHidden);
            }
            // 恢复location.reload
            Object.defineProperty(window.location, 'reload', {
                value: originalReload.bind(window.location),
                configurable: true
            });
            // 清除所有mocks
            jest.clearAllMocks();
        }
    };
};
describe('工厂函数测试', () => {
    let browserMocks;
    beforeEach(() => {
        browserMocks = mockBrowserAPI();
        jest.clearAllMocks();
    });
    afterEach(() => {
        browserMocks.reset();
    });
    test('createUpdateNotifier使用null作为pollingInterval', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: null });
        expect(notifier).toBeDefined();
        // 在null模式下不应该启动自动轮询
        expect(browserMocks.mocks.setTimeout).not.toHaveBeenCalled();
    });
    test('createUpdateNotifier配置不同的轮询间隔', () => {
        const customInterval = 30000;
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: customInterval });
        expect(notifier).toBeDefined();
        expect(browserMocks.mocks.setTimeout).toHaveBeenCalled();
    });
    test('createUpdateNotifier配置自定义indexPath', () => {
        const customPath = '/custom-index.html';
        const notifier = (0, index_1.createUpdateNotifier)({ indexPath: customPath });
        expect(notifier).toBeDefined();
    });
    test('createUpdateNotifier配置自定义scriptRegex', () => {
        const customRegex = /<script.*src=["'](?<src>[^"']+)/gm;
        const notifier = (0, index_1.createUpdateNotifier)({ scriptRegex: customRegex });
        expect(notifier).toBeDefined();
    });
    test('createUpdateNotifier配置自定义提示消息', () => {
        const customMessage = '新版本已发布，是否立即更新？';
        const notifier = (0, index_1.createUpdateNotifier)({ promptMessage: customMessage });
        expect(notifier).toBeDefined();
    });
    test('createUpdateNotifier设置immediate为false', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ immediate: false });
        expect(notifier).toBeDefined();
        // immediate为false时不应立即启动轮询
        expect(browserMocks.mocks.setTimeout).not.toHaveBeenCalled();
    });
    test('createUpdateNotifier设置pauseOnHidden为false', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pauseOnHidden: false });
        expect(notifier).toBeDefined();
        // 检查是否没有添加visibilitychange事件监听器
        expect(browserMocks.mocks.document.addEventListener).not.toHaveBeenCalledWith('visibilitychange', expect.any(Function));
    });
});
describe('边界情况测试', () => {
    let browserMocks;
    beforeEach(() => {
        browserMocks = mockBrowserAPI();
    });
    afterEach(() => {
        browserMocks.reset();
    });
    test('重复调用start方法', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        // 第一次调用start
        jest.clearAllMocks();
        notifier.start();
        // 第二次调用start
        const secondCall = () => notifier.start();
        expect(secondCall).not.toThrow();
    });
    test('重复调用stop方法', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        // 第一次调用stop
        notifier.stop();
        // 第二次调用stop
        const secondCall = () => notifier.stop();
        expect(secondCall).not.toThrow();
    });
    test('stop后再start', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        notifier.stop();
        jest.clearAllMocks();
        notifier.start();
        expect(browserMocks.mocks.setTimeout).toHaveBeenCalled();
    });
    test('设置非常大的轮询间隔', () => {
        const veryLargeInterval = Number.MAX_SAFE_INTEGER;
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: veryLargeInterval });
        expect(notifier).toBeDefined();
    });
    test('设置为负数的轮询间隔（应使用默认值）', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: -1000 });
        expect(notifier).toBeDefined();
        expect(browserMocks.mocks.setTimeout).toHaveBeenCalled();
    });
});
describe('异步回调测试', () => {
    let notifier;
    let browserMocks;
    beforeEach(() => {
        browserMocks = mockBrowserAPI();
        // 模拟confirm
        browserMocks.mocks.confirm.mockImplementation(() => false);
    });
    afterEach(() => {
        browserMocks.reset();
    });
    test('异步onUpdate回调返回true', async () => {
        const mockOnUpdate = jest.fn().mockResolvedValue(true);
        // 模拟fetch返回的HTML内容，以便能检测到更新
        globalThis.fetch.mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.123.js"></script></html>')
        });
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 0,
            notifyType: 'custom',
            onUpdate: mockOnUpdate
        });
        // 模拟location.reload
        const reloadSpy = jest.spyOn(window.location, 'reload').mockImplementation(() => { });
        // 第一次调用不会触发更新（初始化）
        await notifier.checkNow();
        // 模拟新的script内容
        jest.spyOn(globalThis, 'fetch').mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.456.js"></script></html>')
        });
        await notifier.checkUpdate();
        expect(mockOnUpdate).toHaveBeenCalled();
    });
    test('异步onUpdate回调返回false', async () => {
        const mockOnUpdate = jest.fn().mockResolvedValue(false);
        // 模拟fetch返回的HTML内容，以便能检测到更新
        globalThis.fetch.mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.123.js"></script></html>')
        });
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 0,
            notifyType: 'custom',
            onUpdate: mockOnUpdate
        });
        // 模拟location.reload
        const reloadSpy = jest.spyOn(window.location, 'reload').mockImplementation(() => { });
        // 第一次调用不会触发更新（初始化）
        await notifier.checkNow();
        // 模拟新的script内容
        jest.spyOn(globalThis, 'fetch').mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.456.js"></script></html>')
        });
        await notifier.checkUpdate();
        expect(mockOnUpdate).toHaveBeenCalled();
        expect(reloadSpy).not.toHaveBeenCalled();
    });
    test('onDetected回调被正确调用', async () => {
        const mockOnDetected = jest.fn();
        // 模拟fetch返回的HTML内容，以便能检测到更新
        globalThis.fetch.mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.123.js"></script></html>')
        });
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 0,
            onDetected: mockOnDetected
        });
        // 第一次调用不会触发更新（初始化）
        await notifier.checkNow();
        // 模拟新的script内容
        jest.spyOn(globalThis, 'fetch').mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.456.js"></script></html>')
        });
        await notifier.checkUpdate();
        expect(mockOnDetected).toHaveBeenCalled();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9mYWN0b3J5LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FBb0Q7QUFFcEQsa0JBQWtCO0FBQ2xCLE1BQU0sY0FBYyxHQUFHLEdBQUcsRUFBRTtJQUMxQixNQUFNLEtBQUssR0FBRztRQUNaLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBWSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMzQyxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN2QixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNoQixRQUFRLEVBQUU7WUFDUixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNsQjtRQUNELFFBQVEsRUFBRTtZQUNSLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDM0IsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUM5QixNQUFNLEVBQUUsS0FBSztTQUNkO0tBQ0YsQ0FBQztJQUVGLFNBQVM7SUFDVCxNQUFNLGVBQWUsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO0lBQ3ZDLE1BQU0sa0JBQWtCLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQztJQUM3QyxNQUFNLG9CQUFvQixHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUM7SUFDakQsTUFBTSxhQUFhLEdBQUksVUFBa0IsQ0FBQyxLQUFLLENBQUM7SUFDaEQsTUFBTSx3QkFBd0IsR0FBRyxRQUFRLENBQUMsZ0JBQWdCLENBQUM7SUFDM0QsTUFBTSwyQkFBMkIsR0FBRyxRQUFRLENBQUMsbUJBQW1CLENBQUM7SUFDakUsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLHdCQUF3QixDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUMz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LCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9mYWN0b3J5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlVXBkYXRlTm90aWZpZXIgfSBmcm9tICcuLi9zcmMvaW5kZXgnO1xuXG4vLyDkvb/nlKjlronlhajnmoTmtY/op4jlmahBUEnmqKHmi5/nrZbnlaVcbmNvbnN0IG1vY2tCcm93c2VyQVBJID0gKCkgPT4ge1xuICBjb25zdCBtb2NrcyA9IHtcbiAgICBjb25maXJtOiBqZXN0LmZuKCksXG4gICAgc2V0VGltZW91dDogamVzdC5mbigoY2I6IEZ1bmN0aW9uKSA9PiBjYigpKSxcbiAgICBjbGVhclRpbWVvdXQ6IGplc3QuZm4oKSxcbiAgICBmZXRjaDogamVzdC5mbigpLFxuICAgIGxvY2F0aW9uOiB7XG4gICAgICByZWxvYWQ6IGplc3QuZm4oKVxuICAgIH0sXG4gICAgZG9jdW1lbnQ6IHtcbiAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKSxcbiAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXI6IGplc3QuZm4oKSxcbiAgICAgIGhpZGRlbjogZmFsc2VcbiAgICB9XG4gIH07XG5cbiAgLy8g5L+d5a2Y5Y6f5aeL5pa55rOVXG4gIGNvbnN0IG9yaWdpbmFsQ29uZmlybSA9IHdpbmRvdy5jb25maXJtO1xuICBjb25zdCBvcmlnaW5hbFNldFRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dDtcbiAgY29uc3Qgb3JpZ2luYWxDbGVhclRpbWVvdXQgPSB3aW5kb3cuY2xlYXJUaW1lb3V0O1xuICBjb25zdCBvcmlnaW5hbEZldGNoID0gKGdsb2JhbFRoaXMgYXMgYW55KS5mZXRjaDtcbiAgY29uc3Qgb3JpZ2luYWxBZGRFdmVudExpc3RlbmVyID0gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcjtcbiAgY29uc3Qgb3JpZ2luYWxSZW1vdmVFdmVudExpc3RlbmVyID0gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcjtcbiAgY29uc3Qgb3JpZ2luYWxIaWRkZW4gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGRvY3VtZW50LCAnaGlkZGVuJyk7XG4gIGNvbnN0IG9yaWdpbmFsUmVsb2FkID0gRnVuY3Rpb24ucHJvdG90eXBlLmNhbGwuYmluZCh3aW5kb3cubG9jYXRpb24ucmVsb2FkKTtcblxuICAvLyDlupTnlKjmqKHmi59cbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ2NvbmZpcm0nLCB7IHZhbHVlOiBtb2Nrcy5jb25maXJtIH0pO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnc2V0VGltZW91dCcsIHsgdmFsdWU6IG1vY2tzLnNldFRpbWVvdXQgfSk7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdjbGVhclRpbWVvdXQnLCB7IHZhbHVlOiBtb2Nrcy5jbGVhclRpbWVvdXQgfSk7XG4gIChnbG9iYWxUaGlzIGFzIGFueSkuZmV0Y2ggPSBtb2Nrcy5mZXRjaDtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRvY3VtZW50LCAnYWRkRXZlbnRMaXN0ZW5lcicsIHsgdmFsdWU6IG1vY2tzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgfSk7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkb2N1bWVudCwgJ3JlbW92ZUV2ZW50TGlzdGVuZXInLCB7IHZhbHVlOiBtb2Nrcy5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyIH0pO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZG9jdW1lbnQsICdoaWRkZW4nLCB7IFxuICAgIGdldDogKCkgPT4gbW9ja3MuZG9jdW1lbnQuaGlkZGVuLFxuICAgIHNldDogKHZhbHVlOiBib29sZWFuKSA9PiB7IG1vY2tzLmRvY3VtZW50LmhpZGRlbiA9IHZhbHVlOyB9LFxuICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICB9KTtcblxuICAvLyDmqKHmi59sb2NhdGlvbi5yZWxvYWTogIzkuI3lsJ3or5Xkv67mlLnlj6ror7vlsZ7mgKdcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5sb2NhdGlvbiwgJ3JlbG9hZCcsIHtcbiAgICB2YWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICBtb2Nrcy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgIHJldHVybiBvcmlnaW5hbFJlbG9hZCh0aGlzKTtcbiAgICB9LFxuICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICB9KTtcblxuICAvLyDov5Tlm57ph43nva7lh73mlbDlkozmqKHmi5/lr7nosaFcbiAgcmV0dXJuIHtcbiAgICBtb2NrcyxcbiAgICByZXNldDogKCkgPT4ge1xuICAgICAgLy8g5oGi5aSN5Y6f5aeL5pa55rOVXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnY29uZmlybScsIHsgdmFsdWU6IG9yaWdpbmFsQ29uZmlybSB9KTtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdzZXRUaW1lb3V0JywgeyB2YWx1ZTogb3JpZ2luYWxTZXRUaW1lb3V0IH0pO1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ2NsZWFyVGltZW91dCcsIHsgdmFsdWU6IG9yaWdpbmFsQ2xlYXJUaW1lb3V0IH0pO1xuICAgICAgKGdsb2JhbFRoaXMgYXMgYW55KS5mZXRjaCA9IG9yaWdpbmFsRmV0Y2g7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZG9jdW1lbnQsICdhZGRFdmVudExpc3RlbmVyJywgeyB2YWx1ZTogb3JpZ2luYWxBZGRFdmVudExpc3RlbmVyIH0pO1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGRvY3VtZW50LCAncmVtb3ZlRXZlbnRMaXN0ZW5lcicsIHsgdmFsdWU6IG9yaWdpbmFsUmVtb3ZlRXZlbnRMaXN0ZW5lciB9KTtcbiAgICAgIFxuICAgICAgaWYgKG9yaWdpbmFsSGlkZGVuKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShkb2N1bWVudCwgJ2hpZGRlbicsIG9yaWdpbmFsSGlkZGVuKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8g5oGi5aSNbG9jYXRpb24ucmVsb2FkXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LmxvY2F0aW9uLCAncmVsb2FkJywge1xuICAgICAgICB2YWx1ZTogb3JpZ2luYWxSZWxvYWQuYmluZCh3aW5kb3cubG9jYXRpb24pLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICAvLyDmuIXpmaTmiYDmnIltb2Nrc1xuICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgfVxuICB9O1xufTtcblxuZGVzY3JpYmUoJ+W3peWOguWHveaVsOa1i+ivlScsICgpID0+IHtcbiAgbGV0IGJyb3dzZXJNb2NrcztcbiAgXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGJyb3dzZXJNb2NrcyA9IG1vY2tCcm93c2VyQVBJKCk7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuICBcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBicm93c2VyTW9ja3MucmVzZXQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdjcmVhdGVVcGRhdGVOb3RpZmllcuS9v+eUqG51bGzkvZzkuLpwb2xsaW5nSW50ZXJ2YWwnLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogbnVsbCB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgLy8g5ZyobnVsbOaooeW8j+S4i+S4jeW6lOivpeWQr+WKqOiHquWKqOi9ruivolxuICAgIGV4cGVjdChicm93c2VyTW9ja3MubW9ja3Muc2V0VGltZW91dCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdjcmVhdGVVcGRhdGVOb3RpZmllcumFjee9ruS4jeWQjOeahOi9ruivoumXtOmalCcsICgpID0+IHtcbiAgICBjb25zdCBjdXN0b21JbnRlcnZhbCA9IDMwMDAwO1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IGN1c3RvbUludGVydmFsIH0pO1xuICAgIFxuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QoYnJvd3Nlck1vY2tzLm1vY2tzLnNldFRpbWVvdXQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdjcmVhdGVVcGRhdGVOb3RpZmllcumFjee9ruiHquWumuS5iWluZGV4UGF0aCcsICgpID0+IHtcbiAgICBjb25zdCBjdXN0b21QYXRoID0gJy9jdXN0b20taW5kZXguaHRtbCc7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IGluZGV4UGF0aDogY3VzdG9tUGF0aCB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgnY3JlYXRlVXBkYXRlTm90aWZpZXLphY3nva7oh6rlrprkuYlzY3JpcHRSZWdleCcsICgpID0+IHtcbiAgICBjb25zdCBjdXN0b21SZWdleCA9IC88c2NyaXB0LipzcmM9W1wiJ10oPzxzcmM+W15cIiddKykvZ207XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHNjcmlwdFJlZ2V4OiBjdXN0b21SZWdleCB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgnY3JlYXRlVXBkYXRlTm90aWZpZXLphY3nva7oh6rlrprkuYnmj5DnpLrmtojmga8nLCAoKSA9PiB7XG4gICAgY29uc3QgY3VzdG9tTWVzc2FnZSA9ICfmlrDniYjmnKzlt7Llj5HluIPvvIzmmK/lkKbnq4vljbPmm7TmlrDvvJ8nO1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBwcm9tcHRNZXNzYWdlOiBjdXN0b21NZXNzYWdlIH0pO1xuICAgIFxuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdjcmVhdGVVcGRhdGVOb3RpZmllcuiuvue9rmltbWVkaWF0ZeS4umZhbHNlJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBpbW1lZGlhdGU6IGZhbHNlIH0pO1xuICAgIFxuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgICAvLyBpbW1lZGlhdGXkuLpmYWxzZeaXtuS4jeW6lOeri+WNs+WQr+WKqOi9ruivolxuICAgIGV4cGVjdChicm93c2VyTW9ja3MubW9ja3Muc2V0VGltZW91dCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdjcmVhdGVVcGRhdGVOb3RpZmllcuiuvue9rnBhdXNlT25IaWRkZW7kuLpmYWxzZScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgcGF1c2VPbkhpZGRlbjogZmFsc2UgfSk7XG4gICAgXG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICAgIC8vIOajgOafpeaYr+WQpuayoeaciea3u+WKoHZpc2liaWxpdHljaGFuZ2Xkuovku7bnm5HlkKzlmahcbiAgICBleHBlY3QoYnJvd3Nlck1vY2tzLm1vY2tzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpLm5vdC50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndmlzaWJpbGl0eWNoYW5nZScsIGV4cGVjdC5hbnkoRnVuY3Rpb24pKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ+i+ueeVjOaDheWGtea1i+ivlScsICgpID0+IHtcbiAgbGV0IGJyb3dzZXJNb2NrcztcbiAgXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGJyb3dzZXJNb2NrcyA9IG1vY2tCcm93c2VyQVBJKCk7XG4gIH0pO1xuICBcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBicm93c2VyTW9ja3MucmVzZXQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCfph43lpI3osIPnlKhzdGFydOaWueazlScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKCk7XG4gICAgXG4gICAgLy8g56ys5LiA5qyh6LCD55Soc3RhcnRcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBub3RpZmllci5zdGFydCgpO1xuICAgIFxuICAgIC8vIOesrOS6jOasoeiwg+eUqHN0YXJ0XG4gICAgY29uc3Qgc2Vjb25kQ2FsbCA9ICgpID0+IG5vdGlmaWVyLnN0YXJ0KCk7XG4gICAgZXhwZWN0KHNlY29uZENhbGwpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuICBcbiAgdGVzdCgn6YeN5aSN6LCD55Soc3RvcOaWueazlScsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKCk7XG4gICAgXG4gICAgLy8g56ys5LiA5qyh6LCD55Soc3RvcFxuICAgIG5vdGlmaWVyLnN0b3AoKTtcbiAgICBcbiAgICAvLyDnrKzkuozmrKHosIPnlKhzdG9wXG4gICAgY29uc3Qgc2Vjb25kQ2FsbCA9ICgpID0+IG5vdGlmaWVyLnN0b3AoKTtcbiAgICBleHBlY3Qoc2Vjb25kQ2FsbCkubm90LnRvVGhyb3coKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdzdG9w5ZCO5YaNc3RhcnQnLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcigpO1xuICAgIFxuICAgIG5vdGlmaWVyLnN0b3AoKTtcbiAgICBcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBub3RpZmllci5zdGFydCgpO1xuICAgIFxuICAgIGV4cGVjdChicm93c2VyTW9ja3MubW9ja3Muc2V0VGltZW91dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ+iuvue9rumdnuW4uOWkp+eahOi9ruivoumXtOmalCcsICgpID0+IHtcbiAgICBjb25zdCB2ZXJ5TGFyZ2VJbnRlcnZhbCA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSO1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IHZlcnlMYXJnZUludGVydmFsIH0pO1xuICAgIFxuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCforr7nva7kuLrotJ/mlbDnmoTova7or6Lpl7TpmpTvvIjlupTkvb/nlKjpu5jorqTlgLzvvIknLCAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogLTEwMDAgfSk7XG4gICAgXG4gICAgZXhwZWN0KG5vdGlmaWVyKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChicm93c2VyTW9ja3MubW9ja3Muc2V0VGltZW91dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgn5byC5q2l5Zue6LCD5rWL6K+VJywgKCkgPT4ge1xuICBsZXQgbm90aWZpZXI6IGFueTtcbiAgbGV0IGJyb3dzZXJNb2NrcztcbiAgXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGJyb3dzZXJNb2NrcyA9IG1vY2tCcm93c2VyQVBJKCk7XG4gICAgXG4gICAgLy8g5qih5oufY29uZmlybVxuICAgIGJyb3dzZXJNb2Nrcy5tb2Nrcy5jb25maXJtLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBmYWxzZSk7XG4gIH0pO1xuICBcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBicm93c2VyTW9ja3MucmVzZXQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCflvILmraVvblVwZGF0ZeWbnuiwg+i/lOWbnnRydWUnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja09uVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgIFxuICAgIC8vIOaooeaLn2ZldGNo6L+U5Zue55qESFRNTOWGheWuue+8jOS7peS+v+iDveajgOa1i+WIsOabtOaWsFxuICAgIChnbG9iYWxUaGlzLmZldGNoIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LjEyMy5qc1wiPjwvc2NyaXB0PjwvaHRtbD4nKVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoe1xuICAgICAgcG9sbGluZ0ludGVydmFsOiAwLFxuICAgICAgbm90aWZ5VHlwZTogJ2N1c3RvbScsXG4gICAgICBvblVwZGF0ZTogbW9ja09uVXBkYXRlXG4gICAgfSk7XG4gICAgXG4gICAgLy8g5qih5oufbG9jYXRpb24ucmVsb2FkXG4gICAgY29uc3QgcmVsb2FkU3B5ID0gamVzdC5zcHlPbih3aW5kb3cubG9jYXRpb24sICdyZWxvYWQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgIFxuICAgIC8vIOesrOS4gOasoeiwg+eUqOS4jeS8muinpuWPkeabtOaWsO+8iOWIneWni+WMlu+8iVxuICAgIGF3YWl0IG5vdGlmaWVyLmNoZWNrTm93KCk7XG4gICAgXG4gICAgLy8g5qih5ouf5paw55qEc2NyaXB05YaF5a65XG4gICAgamVzdC5zcHlPbihnbG9iYWxUaGlzLCAnZmV0Y2gnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuNDU2LmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgbm90aWZpZXIuY2hlY2tVcGRhdGUoKTtcbiAgICBcbiAgICBleHBlY3QobW9ja09uVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgn5byC5q2lb25VcGRhdGXlm57osIPov5Tlm55mYWxzZScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2NrT25VcGRhdGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgIFxuICAgIC8vIOaooeaLn2ZldGNo6L+U5Zue55qESFRNTOWGheWuue+8jOS7peS+v+iDveajgOa1i+WIsOabtOaWsFxuICAgIChnbG9iYWxUaGlzLmZldGNoIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LjEyMy5qc1wiPjwvc2NyaXB0PjwvaHRtbD4nKVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoe1xuICAgICAgcG9sbGluZ0ludGVydmFsOiAwLFxuICAgICAgbm90aWZ5VHlwZTogJ2N1c3RvbScsXG4gICAgICBvblVwZGF0ZTogbW9ja09uVXBkYXRlXG4gICAgfSk7XG4gICAgXG4gICAgLy8g5qih5oufbG9jYXRpb24ucmVsb2FkXG4gICAgY29uc3QgcmVsb2FkU3B5ID0gamVzdC5zcHlPbih3aW5kb3cubG9jYXRpb24sICdyZWxvYWQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgIFxuICAgIC8vIOesrOS4gOasoeiwg+eUqOS4jeS8muinpuWPkeabtOaWsO+8iOWIneWni+WMlu+8iVxuICAgIGF3YWl0IG5vdGlmaWVyLmNoZWNrTm93KCk7XG4gICAgXG4gICAgLy8g5qih5ouf5paw55qEc2NyaXB05YaF5a65XG4gICAgamVzdC5zcHlPbihnbG9iYWxUaGlzLCAnZmV0Y2gnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuNDU2LmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgbm90aWZpZXIuY2hlY2tVcGRhdGUoKTtcbiAgICBcbiAgICBleHBlY3QobW9ja09uVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgZXhwZWN0KHJlbG9hZFNweSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdvbkRldGVjdGVk5Zue6LCD6KKr5q2j56Gu6LCD55SoJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tPbkRldGVjdGVkID0gamVzdC5mbigpO1xuICAgIFxuICAgIC8vIOaooeaLn2ZldGNo6L+U5Zue55qESFRNTOWGheWuue+8jOS7peS+v+iDveajgOa1i+WIsOabtOaWsFxuICAgIChnbG9iYWxUaGlzLmZldGNoIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LjEyMy5qc1wiPjwvc2NyaXB0PjwvaHRtbD4nKVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoe1xuICAgICAgcG9sbGluZ0ludGVydmFsOiAwLFxuICAgICAgb25EZXRlY3RlZDogbW9ja09uRGV0ZWN0ZWRcbiAgICB9KTtcbiAgICBcbiAgICAvLyDnrKzkuIDmrKHosIPnlKjkuI3kvJrop6blj5Hmm7TmlrDvvIjliJ3lp4vljJbvvIlcbiAgICBhd2FpdCBub3RpZmllci5jaGVja05vdygpO1xuICAgIFxuICAgIC8vIOaooeaLn+aWsOeahHNjcmlwdOWGheWuuVxuICAgIGplc3Quc3B5T24oZ2xvYmFsVGhpcywgJ2ZldGNoJykubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LjQ1Ni5qc1wiPjwvc2NyaXB0PjwvaHRtbD4nKVxuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IG5vdGlmaWVyLmNoZWNrVXBkYXRlKCk7XG4gICAgXG4gICAgZXhwZWN0KG1vY2tPbkRldGVjdGVkKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9