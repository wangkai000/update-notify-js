86969eb7a911ebc979ac070c86872c92
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../src/index");
describe('工厂函数测试', () => {
    beforeEach(() => {
        // 重置所有模拟
        jest.clearAllMocks();
        // 保存并模拟全局对象
        jest.spyOn(window, 'setTimeout').mockImplementation(() => 1);
        jest.spyOn(window, 'clearTimeout').mockImplementation(() => { });
    });
    afterEach(() => {
        // 恢复原始方法
        jest.restoreAllMocks();
    });
    test('createUpdateNotifier使用null作为pollingInterval', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: null });
        expect(notifier).toBeDefined();
        // 在null模式下不应该启动自动轮询
        expect(setTimeout).not.toHaveBeenCalled();
    });
    test('createUpdateNotifier配置不同的轮询间隔', () => {
        const customInterval = 30000;
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: customInterval });
        expect(notifier).toBeDefined();
        expect(setTimeout).toHaveBeenCalled();
    });
    test('createUpdateNotifier配置自定义indexPath', () => {
        const customPath = '/custom-index.html';
        const notifier = (0, index_1.createUpdateNotifier)({ indexPath: customPath });
        expect(notifier).toBeDefined();
    });
    test('createUpdateNotifier配置自定义scriptRegex', () => {
        const customRegex = /<script.*src=["'](?<src>[^"']+)/gm;
        const notifier = (0, index_1.createUpdateNotifier)({ scriptRegex: customRegex });
        expect(notifier).toBeDefined();
    });
    test('createUpdateNotifier配置自定义提示消息', () => {
        const customMessage = '新版本已发布，是否立即更新？';
        const notifier = (0, index_1.createUpdateNotifier)({ promptMessage: customMessage });
        expect(notifier).toBeDefined();
    });
    test('createUpdateNotifier设置immediate为false', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ immediate: false });
        expect(notifier).toBeDefined();
        // immediate为false时不应立即启动轮询
        expect(setTimeout).not.toHaveBeenCalled();
    });
    test('createUpdateNotifier设置pauseOnHidden为false', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pauseOnHidden: false });
        expect(notifier).toBeDefined();
        // 检查是否没有添加visibilitychange事件监听器
        expect(document.addEventListener).not.toHaveBeenCalledWith('visibilitychange', expect.any(Function));
    });
});
describe('边界情况测试', () => {
    beforeEach(() => {
        jest.spyOn(window, 'setTimeout').mockImplementation(() => 1);
        jest.spyOn(window, 'clearTimeout').mockImplementation(() => { });
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
    test('重复调用start方法', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        // 第一次调用start
        jest.clearAllMocks();
        notifier.start();
        // 第二次调用start
        const secondCall = () => notifier.start();
        expect(secondCall).not.toThrow();
    });
    test('重复调用stop方法', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        // 第一次调用stop
        notifier.stop();
        // 第二次调用stop
        const secondCall = () => notifier.stop();
        expect(secondCall).not.toThrow();
    });
    test('stop后再start', () => {
        const notifier = (0, index_1.createUpdateNotifier)();
        notifier.stop();
        jest.clearAllMocks();
        notifier.start();
        expect(setTimeout).toHaveBeenCalled();
    });
    test('设置非常大的轮询间隔', () => {
        const veryLargeInterval = Number.MAX_SAFE_INTEGER;
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: veryLargeInterval });
        expect(notifier).toBeDefined();
    });
    test('设置为负数的轮询间隔（应使用默认值）', () => {
        const notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: -1000 });
        expect(notifier).toBeDefined();
        expect(setTimeout).toHaveBeenCalled();
    });
});
describe('异步回调测试', () => {
    let notifier;
    beforeEach(() => {
        // 保存原始方法
        originalFetch = globalThis.fetch;
        // 安全地模拟fetch，确保它在全局对象上存在
        if (!globalThis.fetch) {
            globalThis.fetch = jest.fn();
        }
        jest.spyOn(window, 'setTimeout').mockImplementation(() => 1);
        jest.spyOn(window, 'clearTimeout').mockImplementation(() => { });
        notifier = (0, index_1.createUpdateNotifier)({ pollingInterval: 0 });
    });
    afterEach(() => {
        // 恢复原始方法
        if (originalFetch) {
            globalThis.fetch = originalFetch;
        }
        else {
            delete globalThis.fetch;
        }
        jest.restoreAllMocks();
    });
    test('异步onUpdate回调返回true', async () => {
        const mockOnUpdate = jest.fn().mockResolvedValue(true);
        // 模拟fetch返回的HTML内容，以便能检测到更新
        globalThis.fetch.mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.123.js"></script></html>')
        });
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 0,
            notifyType: 'custom',
            onUpdate: mockOnUpdate
        });
        // 模拟location.reload
        const reloadSpy = jest.spyOn(window.location, 'reload').mockImplementation(() => { });
        // 第一次调用不会触发更新（初始化）
        await notifier.checkNow();
        // 模拟新的script内容
        jest.spyOn(globalThis, 'fetch').mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.456.js"></script></html>')
        });
        await notifier.checkUpdate();
        expect(mockOnUpdate).toHaveBeenCalled();
    });
    test('异步onUpdate回调返回false', async () => {
        const mockOnUpdate = jest.fn().mockResolvedValue(false);
        // 模拟fetch返回的HTML内容，以便能检测到更新
        globalThis.fetch.mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.123.js"></script></html>')
        });
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 0,
            notifyType: 'custom',
            onUpdate: mockOnUpdate
        });
        // 模拟location.reload
        const reloadSpy = jest.spyOn(window.location, 'reload').mockImplementation(() => { });
        // 第一次调用不会触发更新（初始化）
        await notifier.checkNow();
        // 模拟新的script内容
        jest.spyOn(globalThis, 'fetch').mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.456.js"></script></html>')
        });
        await notifier.checkUpdate();
        expect(mockOnUpdate).toHaveBeenCalled();
        expect(reloadSpy).not.toHaveBeenCalled();
    });
    test('onDetected回调被正确调用', async () => {
        const mockOnDetected = jest.fn();
        // 模拟fetch返回的HTML内容，以便能检测到更新
        globalThis.fetch.mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.123.js"></script></html>')
        });
        const notifier = (0, index_1.createUpdateNotifier)({
            pollingInterval: 0,
            onDetected: mockOnDetected
        });
        // 第一次调用不会触发更新（初始化）
        await notifier.checkNow();
        // 模拟新的script内容
        jest.spyOn(globalThis, 'fetch').mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.456.js"></script></html>')
        });
        await notifier.checkUpdate();
        expect(mockOnDetected).toHaveBeenCalled();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9mYWN0b3J5LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FBb0Q7QUFFcEQsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7SUFDdEIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFNBQVM7UUFDVCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsWUFBWTtRQUNaLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLFlBQVksQ0FBQyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2xFLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLFNBQVM7UUFDVCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsNkNBQTZDLEVBQUUsR0FBRyxFQUFFO1FBQ3ZELE1BQU0sUUFBUSxHQUFHLElBQUEsNEJBQW9CLEVBQUMsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUVqRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDL0Isb0JBQW9CO1FBQ3BCLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUM1QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDekMsTUFBTSxjQUFjLEdBQUcsS0FBSyxDQUFDO1FBQzdCLE1BQU0sUUFBUSxHQUFHLElBQUEsNEJBQW9CLEVBQUMsRUFBRSxlQUFlLEVB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QUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7UUFFakMsNEJBQTRCO1FBQzNCLFVBQVUsQ0FBQyxLQUFtQixDQUFDLGlCQUFpQixDQUFDO1lBQ2hELElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsbURBQW1ELENBQUM7U0FDdkYsQ0FBQyxDQUFDO1FBRUgsTUFBTSxRQUFRLEdBQUcsSUFBQSw0QkFBb0IsRUFBQztZQUNwQyxlQUFlLEVBQUUsQ0FBQztZQUNsQixVQUFVLEVBQUUsY0FBYztTQUMzQixDQUFDLENBQUM7UUFFSCxtQkFBbUI7UUFDbkIsTUFBTSxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7UUFFMUIsZUFBZTtRQUNmLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDLGlCQUFpQixDQUFDO1lBQ2hELElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsbURBQW1ELENBQUM7U0FDdkYsQ0FBQyxDQUFDO1FBRUgsTUFBTSxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFN0IsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDNUMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvU2hhcmVkL1ByZXZpb3VzbHkgUmVsb2NhdGVkIEl0ZW1zL1NlY3VyaXR5L215UHJvamllY3QvYWlfcHJvamV0L3Rlc3RzL2ZhY3RvcnkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVVcGRhdGVOb3RpZmllciB9IGZyb20gJy4uL3NyYy9pbmRleCc7XG5cbmRlc2NyaWJlKCflt6XljoLlh73mlbDmtYvor5UnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIOmHjee9ruaJgOacieaooeaLn1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIC8vIOS/neWtmOW5tuaooeaLn+WFqOWxgOWvueixoVxuICAgIGplc3Quc3B5T24od2luZG93LCAnc2V0VGltZW91dCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAxKTtcbiAgICBqZXN0LnNweU9uKHdpbmRvdywgJ2NsZWFyVGltZW91dCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gIH0pO1xuICBcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAvLyDmgaLlpI3ljp/lp4vmlrnms5VcbiAgICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ2NyZWF0ZVVwZGF0ZU5vdGlmaWVy5L2/55SobnVsbOS9nOS4unBvbGxpbmdJbnRlcnZhbCcsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgcG9sbGluZ0ludGVydmFsOiBudWxsIH0pO1xuICAgIFxuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgICAvLyDlnKhudWxs5qih5byP5LiL5LiN5bqU6K+l5ZCv5Yqo6Ieq5Yqo6L2u6K+iXG4gICAgZXhwZWN0KHNldFRpbWVvdXQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgnY3JlYXRlVXBkYXRlTm90aWZpZXLphY3nva7kuI3lkIznmoTova7or6Lpl7TpmpQnLCAoKSA9PiB7XG4gICAgY29uc3QgY3VzdG9tSW50ZXJ2YWwgPSAzMDAwMDtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgcG9sbGluZ0ludGVydmFsOiBjdXN0b21JbnRlcnZhbCB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KHNldFRpbWVvdXQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdjcmVhdGVVcGRhdGVOb3RpZmllcumFjee9ruiHquWumuS5iWluZGV4UGF0aCcsICgpID0+IHtcbiAgICBjb25zdCBjdXN0b21QYXRoID0gJy9jdXN0b20taW5kZXguaHRtbCc7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IGluZGV4UGF0aDogY3VzdG9tUGF0aCB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgnY3JlYXRlVXBkYXRlTm90aWZpZXLphY3nva7oh6rlrprkuYlzY3JpcHRSZWdleCcsICgpID0+IHtcbiAgICBjb25zdCBjdXN0b21SZWdleCA9IC88c2NyaXB0LipzcmM9W1wiJ10oPzxzcmM+W15cIiddKykvZ207XG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7IHNjcmlwdFJlZ2V4OiBjdXN0b21SZWdleCB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgnY3JlYXRlVXBkYXRlTm90aWZpZXLphY3nva7oh6rlrprkuYnmj5DnpLrmtojmga8nLCAoKSA9PiB7XG4gICAgY29uc3QgY3VzdG9tTWVzc2FnZSA9ICfmlrDniYjmnKzlt7Llj5HluIPvvIzmmK/lkKbnq4vljbPmm7TmlrDvvJ8nO1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBwcm9tcHRNZXNzYWdlOiBjdXN0b21NZXNzYWdlIH0pO1xuICAgIFxuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdjcmVhdGVVcGRhdGVOb3RpZmllcuiuvue9rmltbWVkaWF0ZeS4umZhbHNlJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBpbW1lZGlhdGU6IGZhbHNlIH0pO1xuICAgIFxuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgICAvLyBpbW1lZGlhdGXkuLpmYWxzZeaXtuS4jeW6lOeri+WNs+WQr+WKqOi9ruivolxuICAgIGV4cGVjdChzZXRUaW1lb3V0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ2NyZWF0ZVVwZGF0ZU5vdGlmaWVy6K6+572ucGF1c2VPbkhpZGRlbuS4umZhbHNlJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBwYXVzZU9uSGlkZGVuOiBmYWxzZSB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgLy8g5qOA5p+l5piv5ZCm5rKh5pyJ5re75YqgdmlzaWJpbGl0eWNoYW5nZeS6i+S7tuebkeWQrOWZqFxuICAgIGV4cGVjdChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKS5ub3QudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Zpc2liaWxpdHljaGFuZ2UnLCBleHBlY3QuYW55KEZ1bmN0aW9uKSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCfovrnnlYzmg4XlhrXmtYvor5UnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3Quc3B5T24od2luZG93LCAnc2V0VGltZW91dCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAxKTtcbiAgICBqZXN0LnNweU9uKHdpbmRvdywgJ2NsZWFyVGltZW91dCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gIH0pO1xuICBcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ+mHjeWkjeiwg+eUqHN0YXJ05pa55rOVJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoKTtcbiAgICBcbiAgICAvLyDnrKzkuIDmrKHosIPnlKhzdGFydFxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIG5vdGlmaWVyLnN0YXJ0KCk7XG4gICAgXG4gICAgLy8g56ys5LqM5qyh6LCD55Soc3RhcnRcbiAgICBjb25zdCBzZWNvbmRDYWxsID0gKCkgPT4gbm90aWZpZXIuc3RhcnQoKTtcbiAgICBleHBlY3Qoc2Vjb25kQ2FsbCkubm90LnRvVGhyb3coKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCfph43lpI3osIPnlKhzdG9w5pa55rOVJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoKTtcbiAgICBcbiAgICAvLyDnrKzkuIDmrKHosIPnlKhzdG9wXG4gICAgbm90aWZpZXIuc3RvcCgpO1xuICAgIFxuICAgIC8vIOesrOS6jOasoeiwg+eUqHN0b3BcbiAgICBjb25zdCBzZWNvbmRDYWxsID0gKCkgPT4gbm90aWZpZXIuc3RvcCgpO1xuICAgIGV4cGVjdChzZWNvbmRDYWxsKS5ub3QudG9UaHJvdygpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ3N0b3DlkI7lho1zdGFydCcsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKCk7XG4gICAgXG4gICAgbm90aWZpZXIuc3RvcCgpO1xuICAgIFxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIG5vdGlmaWVyLnN0YXJ0KCk7XG4gICAgXG4gICAgZXhwZWN0KHNldFRpbWVvdXQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCforr7nva7pnZ7luLjlpKfnmoTova7or6Lpl7TpmpQnLCAoKSA9PiB7XG4gICAgY29uc3QgdmVyeUxhcmdlSW50ZXJ2YWwgPSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUjtcbiAgICBjb25zdCBub3RpZmllciA9IGNyZWF0ZVVwZGF0ZU5vdGlmaWVyKHsgcG9sbGluZ0ludGVydmFsOiB2ZXJ5TGFyZ2VJbnRlcnZhbCB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuICBcbiAgdGVzdCgn6K6+572u5Li66LSf5pWw55qE6L2u6K+i6Ze06ZqU77yI5bqU5L2/55So6buY6K6k5YC877yJJywgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IC0xMDAwIH0pO1xuICAgIFxuICAgIGV4cGVjdChub3RpZmllcikudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3Qoc2V0VGltZW91dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgn5byC5q2l5Zue6LCD5rWL6K+VJywgKCkgPT4ge1xuICBsZXQgbm90aWZpZXI6IGFueTtcbiAgXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIOS/neWtmOWOn+Wni+aWueazlVxuICAgIG9yaWdpbmFsRmV0Y2ggPSBnbG9iYWxUaGlzLmZldGNoO1xuICAgIFxuICAgIC8vIOWuieWFqOWcsOaooeaLn2ZldGNo77yM56Gu5L+d5a6D5Zyo5YWo5bGA5a+56LGh5LiK5a2Y5ZyoXG4gICAgaWYgKCFnbG9iYWxUaGlzLmZldGNoKSB7XG4gICAgICAoZ2xvYmFsVGhpcyBhcyBhbnkpLmZldGNoID0gamVzdC5mbigpO1xuICAgIH1cbiAgICBcbiAgICBqZXN0LnNweU9uKHdpbmRvdywgJ3NldFRpbWVvdXQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gMSk7XG4gICAgamVzdC5zcHlPbih3aW5kb3csICdjbGVhclRpbWVvdXQnKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xuICAgIFxuICAgIG5vdGlmaWVyID0gY3JlYXRlVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IDAgfSk7XG4gIH0pO1xuICBcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAvLyDmgaLlpI3ljp/lp4vmlrnms5VcbiAgICBpZiAob3JpZ2luYWxGZXRjaCkge1xuICAgICAgZ2xvYmFsVGhpcy5mZXRjaCA9IG9yaWdpbmFsRmV0Y2g7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGV0ZSAoZ2xvYmFsVGhpcyBhcyBhbnkpLmZldGNoO1xuICAgIH1cbiAgICBcbiAgICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ+W8guatpW9uVXBkYXRl5Zue6LCD6L+U5ZuedHJ1ZScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2NrT25VcGRhdGUgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgXG4gICAgLy8g5qih5oufZmV0Y2jov5Tlm57nmoRIVE1M5YaF5a6577yM5Lul5L6/6IO95qOA5rWL5Yiw5pu05pawXG4gICAgKGdsb2JhbFRoaXMuZmV0Y2ggYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuMTIzLmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7XG4gICAgICBwb2xsaW5nSW50ZXJ2YWw6IDAsXG4gICAgICBub3RpZnlUeXBlOiAnY3VzdG9tJyxcbiAgICAgIG9uVXBkYXRlOiBtb2NrT25VcGRhdGVcbiAgICB9KTtcbiAgICBcbiAgICAvLyDmqKHmi59sb2NhdGlvbi5yZWxvYWRcbiAgICBjb25zdCByZWxvYWRTcHkgPSBqZXN0LnNweU9uKHdpbmRvdy5sb2NhdGlvbiwgJ3JlbG9hZCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgXG4gICAgLy8g56ys5LiA5qyh6LCD55So5LiN5Lya6Kem5Y+R5pu05paw77yI5Yid5aeL5YyW77yJXG4gICAgYXdhaXQgbm90aWZpZXIuY2hlY2tOb3coKTtcbiAgICBcbiAgICAvLyDmqKHmi5/mlrDnmoRzY3JpcHTlhoXlrrlcbiAgICBqZXN0LnNweU9uKGdsb2JhbFRoaXMsICdmZXRjaCcpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHRleHQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnPGh0bWw+PHNjcmlwdCBzcmM9XCIvdGVzdC40NTYuanNcIj48L3NjcmlwdD48L2h0bWw+JylcbiAgICB9KTtcbiAgICBcbiAgICBhd2FpdCBub3RpZmllci5jaGVja1VwZGF0ZSgpO1xuICAgIFxuICAgIGV4cGVjdChtb2NrT25VcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCflvILmraVvblVwZGF0ZeWbnuiwg+i/lOWbnmZhbHNlJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tPblVwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG4gICAgXG4gICAgLy8g5qih5oufZmV0Y2jov5Tlm57nmoRIVE1M5YaF5a6577yM5Lul5L6/6IO95qOA5rWL5Yiw5pu05pawXG4gICAgKGdsb2JhbFRoaXMuZmV0Y2ggYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuMTIzLmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7XG4gICAgICBwb2xsaW5nSW50ZXJ2YWw6IDAsXG4gICAgICBub3RpZnlUeXBlOiAnY3VzdG9tJyxcbiAgICAgIG9uVXBkYXRlOiBtb2NrT25VcGRhdGVcbiAgICB9KTtcbiAgICBcbiAgICAvLyDmqKHmi59sb2NhdGlvbi5yZWxvYWRcbiAgICBjb25zdCByZWxvYWRTcHkgPSBqZXN0LnNweU9uKHdpbmRvdy5sb2NhdGlvbiwgJ3JlbG9hZCcpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgXG4gICAgLy8g56ys5LiA5qyh6LCD55So5LiN5Lya6Kem5Y+R5pu05paw77yI5Yid5aeL5YyW77yJXG4gICAgYXdhaXQgbm90aWZpZXIuY2hlY2tOb3coKTtcbiAgICBcbiAgICAvLyDmqKHmi5/mlrDnmoRzY3JpcHTlhoXlrrlcbiAgICBqZXN0LnNweU9uKGdsb2JhbFRoaXMsICdmZXRjaCcpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHRleHQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnPGh0bWw+PHNjcmlwdCBzcmM9XCIvdGVzdC40NTYuanNcIj48L3NjcmlwdD48L2h0bWw+JylcbiAgICB9KTtcbiAgICBcbiAgICBhd2FpdCBub3RpZmllci5jaGVja1VwZGF0ZSgpO1xuICAgIFxuICAgIGV4cGVjdChtb2NrT25VcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICBleHBlY3QocmVsb2FkU3B5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcbiAgXG4gIHRlc3QoJ29uRGV0ZWN0ZWTlm57osIPooqvmraPnoa7osIPnlKgnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja09uRGV0ZWN0ZWQgPSBqZXN0LmZuKCk7XG4gICAgXG4gICAgLy8g5qih5oufZmV0Y2jov5Tlm57nmoRIVE1M5YaF5a6577yM5Lul5L6/6IO95qOA5rWL5Yiw5pu05pawXG4gICAgKGdsb2JhbFRoaXMuZmV0Y2ggYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuMTIzLmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gICAgXG4gICAgY29uc3Qgbm90aWZpZXIgPSBjcmVhdGVVcGRhdGVOb3RpZmllcih7XG4gICAgICBwb2xsaW5nSW50ZXJ2YWw6IDAsXG4gICAgICBvbkRldGVjdGVkOiBtb2NrT25EZXRlY3RlZFxuICAgIH0pO1xuICAgIFxuICAgIC8vIOesrOS4gOasoeiwg+eUqOS4jeS8muinpuWPkeabtOaWsO+8iOWIneWni+WMlu+8iVxuICAgIGF3YWl0IG5vdGlmaWVyLmNoZWNrTm93KCk7XG4gICAgXG4gICAgLy8g5qih5ouf5paw55qEc2NyaXB05YaF5a65XG4gICAgamVzdC5zcHlPbihnbG9iYWxUaGlzLCAnZmV0Y2gnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuNDU2LmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gICAgXG4gICAgYXdhaXQgbm90aWZpZXIuY2hlY2tVcGRhdGUoKTtcbiAgICBcbiAgICBleHBlY3QobW9ja09uRGV0ZWN0ZWQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=