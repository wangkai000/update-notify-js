5385cddfcaa9bd0baa4195c032d94499
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../src/index");
describe('VersionUpdateNotifier 简化测试', () => {
    // 在每个测试前重置全局模拟
    beforeEach(() => {
        // 清除所有现有的模拟
        jest.clearAllMocks();
        // 基本的浏览器API模拟
        global.window = {
            ...global.window,
            confirm: jest.fn(() => true),
            setTimeout: jest.fn((callback) => {
                if (typeof callback === 'function') {
                    callback();
                }
                return 1;
            }),
            clearTimeout: jest.fn(),
            location: {
                reload: jest.fn()
            }
        };
        global.document = {
            ...global.document,
            addEventListener: jest.fn(),
            removeEventListener: jest.fn(),
            hidden: false,
        };
        global.fetch = jest.fn().mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.js"></script></html>')
        });
    });
    // 测试实例创建
    test('VersionUpdateNotifier可以被实例化', () => {
        expect(() => new index_1.VersionUpdateNotifier()).not.toThrow();
    });
    test('VersionUpdateNotifier接受不同的配置选项', () => {
        const optionsList = [
            { pollingInterval: 10000 },
            { indexPath: '/custom-index.html' },
            { scriptRegex: /script/ },
            { promptMessage: '有新版本！' },
            { notificationType: 'confirm' },
            { immediate: false },
            { pauseOnHidden: false },
        ];
        optionsList.forEach(options => {
            expect(() => new index_1.VersionUpdateNotifier(options)).not.toThrow();
        });
    });
    // 测试公共方法
    test('公共方法可以被安全调用', () => {
        const notifier = new index_1.VersionUpdateNotifier({ pollingInterval: null });
        // 确保所有公共方法都可以被调用
        expect(() => notifier.start()).not.toThrow();
        expect(() => notifier.stop()).not.toThrow();
        expect(() => notifier.reset()).not.toThrow();
    });
    // 异步方法测试
    test('异步方法不会抛出未捕获的异常', async () => {
        const notifier = new index_1.VersionUpdateNotifier({ pollingInterval: null });
        // 测试异步方法不会抛出未捕获的异常
        await expect(notifier.checkNow()).resolves.not.toThrow();
        await expect(notifier.checkUpdate()).resolves.not.toThrow();
    });
    // 回调函数测试
    test('回调函数配置有效', () => {
        const onUpdate = jest.fn(() => true);
        const onDetected = jest.fn();
        const notifier = new index_1.VersionUpdateNotifier({
            pollingInterval: null,
            onUpdate,
            onDetected
        });
        expect(notifier).toBeDefined();
    });
    // 边界情况测试
    test('重复调用方法不会导致错误', () => {
        const notifier = new index_1.VersionUpdateNotifier({ pollingInterval: null });
        // 测试重复调用
        expect(() => {
            notifier.start();
            notifier.start(); // 重复调用
            notifier.stop();
            notifier.stop(); // 重复调用
            notifier.reset();
            notifier.reset(); // 重复调用
        }).not.toThrow();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9pbmRleC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsd0NBQXFEO0FBRXJELFFBQVEsQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7SUFDMUMsZUFBZTtJQUNmLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxZQUFZO1FBQ1osSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLGNBQWM7UUFDZCxNQUFNLENBQUMsTUFBTSxHQUFHO1lBQ2QsR0FBRyxNQUFNLENBQUMsTUFBTTtZQUNoQixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDNUIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtnQkFDL0IsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVLEVBQUUsQ0FBQztvQkFDbkMsUUFBUSxFQUFFLENBQUM7Z0JBQ2IsQ0FBQztnQkFDRCxPQUFPLENBQUMsQ0FBQztZQUNYLENBQUMsQ0FBQztZQUNGLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLFFBQVEsRUFBRTtnQkFDUixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTthQUNsQjtTQUNLLENBQUM7UUFFVCxNQUFNLENBQUMsUUFBUSxHQUFHO1lBQ2hCLEdBQUcsTUFBTSxDQUFDLFFBQVE7WUFDbEIsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMzQixtQkFBbUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzlCLE1BQU0sRUFBRSxLQUFLO1NBQ1AsQ0FBQztRQUVULE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO1lBQ3pDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlC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SUFBSSw2QkFBcUIsQ0FBQyxFQUFFLGVBQWUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRXRFLFNBQVM7UUFDVCxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLE9BQU87WUFDekIsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2hCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQU87WUFDeEIsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLE9BQU87UUFDM0IsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ25CLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9pbmRleC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZlcnNpb25VcGRhdGVOb3RpZmllciB9IGZyb20gJy4uL3NyYy9pbmRleCc7XG5cbmRlc2NyaWJlKCdWZXJzaW9uVXBkYXRlTm90aWZpZXIg566A5YyW5rWL6K+VJywgKCkgPT4ge1xuICAvLyDlnKjmr4/kuKrmtYvor5XliY3ph43nva7lhajlsYDmqKHmi59cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgLy8g5riF6Zmk5omA5pyJ546w5pyJ55qE5qih5oufXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgXG4gICAgLy8g5Z+65pys55qE5rWP6KeI5ZmoQVBJ5qih5oufXG4gICAgZ2xvYmFsLndpbmRvdyA9IHtcbiAgICAgIC4uLmdsb2JhbC53aW5kb3csXG4gICAgICBjb25maXJtOiBqZXN0LmZuKCgpID0+IHRydWUpLFxuICAgICAgc2V0VGltZW91dDogamVzdC5mbigoY2FsbGJhY2spID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9KSxcbiAgICAgIGNsZWFyVGltZW91dDogamVzdC5mbigpLFxuICAgICAgbG9jYXRpb246IHtcbiAgICAgICAgcmVsb2FkOiBqZXN0LmZuKClcbiAgICAgIH1cbiAgICB9IGFzIGFueTtcbiAgICBcbiAgICBnbG9iYWwuZG9jdW1lbnQgPSB7XG4gICAgICAuLi5nbG9iYWwuZG9jdW1lbnQsXG4gICAgICBhZGRFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgICBoaWRkZW46IGZhbHNlLFxuICAgIH0gYXMgYW55O1xuICAgIFxuICAgIGdsb2JhbC5mZXRjaCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICB0ZXh0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoJzxodG1sPjxzY3JpcHQgc3JjPVwiL3Rlc3QuanNcIj48L3NjcmlwdD48L2h0bWw+JylcbiAgICB9KTtcbiAgfSk7XG4gIFxuICAvLyDmtYvor5Xlrp7kvovliJvlu7pcbiAgdGVzdCgnVmVyc2lvblVwZGF0ZU5vdGlmaWVy5Y+v5Lul6KKr5a6e5L6L5YyWJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgVmVyc2lvblVwZGF0ZU5vdGlmaWVyKCkpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuICBcbiAgdGVzdCgnVmVyc2lvblVwZGF0ZU5vdGlmaWVy5o6l5Y+X5LiN5ZCM55qE6YWN572u6YCJ6aG5JywgKCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbnNMaXN0ID0gW1xuICAgICAgeyBwb2xsaW5nSW50ZXJ2YWw6IDEwMDAwIH0sXG4gICAgICB7IGluZGV4UGF0aDogJy9jdXN0b20taW5kZXguaHRtbCcgfSxcbiAgICAgIHsgc2NyaXB0UmVnZXg6IC9zY3JpcHQvIH0sXG4gICAgICB7IHByb21wdE1lc3NhZ2U6ICfmnInmlrDniYjmnKzvvIEnIH0sXG4gICAgICB7IG5vdGlmaWNhdGlvblR5cGU6ICdjb25maXJtJyBhcyBjb25zdCB9LFxuICAgICAgeyBpbW1lZGlhdGU6IGZhbHNlIH0sXG4gICAgICB7IHBhdXNlT25IaWRkZW46IGZhbHNlIH0sXG4gICAgXTtcbiAgICBcbiAgICBvcHRpb25zTGlzdC5mb3JFYWNoKG9wdGlvbnMgPT4ge1xuICAgICAgZXhwZWN0KCgpID0+IG5ldyBWZXJzaW9uVXBkYXRlTm90aWZpZXIob3B0aW9ucykpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuICBcbiAgLy8g5rWL6K+V5YWs5YWx5pa55rOVXG4gIHRlc3QoJ+WFrOWFseaWueazleWPr+S7peiiq+WuieWFqOiwg+eUqCcsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IG5ldyBWZXJzaW9uVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IG51bGwgfSk7XG4gICAgXG4gICAgLy8g56Gu5L+d5omA5pyJ5YWs5YWx5pa55rOV6YO95Y+v5Lul6KKr6LCD55SoXG4gICAgZXhwZWN0KCgpID0+IG5vdGlmaWVyLnN0YXJ0KCkpLm5vdC50b1Rocm93KCk7XG4gICAgZXhwZWN0KCgpID0+IG5vdGlmaWVyLnN0b3AoKSkubm90LnRvVGhyb3coKTtcbiAgICBleHBlY3QoKCkgPT4gbm90aWZpZXIucmVzZXQoKSkubm90LnRvVGhyb3coKTtcbiAgfSk7XG4gIFxuICAvLyDlvILmraXmlrnms5XmtYvor5VcbiAgdGVzdCgn5byC5q2l5pa55rOV5LiN5Lya5oqb5Ye65pyq5o2V6I6355qE5byC5bi4JywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG5vdGlmaWVyID0gbmV3IFZlcnNpb25VcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogbnVsbCB9KTtcbiAgICBcbiAgICAvLyDmtYvor5XlvILmraXmlrnms5XkuI3kvJrmipvlh7rmnKrmjZXojrfnmoTlvILluLhcbiAgICBhd2FpdCBleHBlY3Qobm90aWZpZXIuY2hlY2tOb3coKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICBhd2FpdCBleHBlY3Qobm90aWZpZXIuY2hlY2tVcGRhdGUoKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgfSk7XG4gIFxuICAvLyDlm57osIPlh73mlbDmtYvor5VcbiAgdGVzdCgn5Zue6LCD5Ye95pWw6YWN572u5pyJ5pWIJywgKCkgPT4ge1xuICAgIGNvbnN0IG9uVXBkYXRlID0gamVzdC5mbigoKSA9PiB0cnVlKTtcbiAgICBjb25zdCBvbkRldGVjdGVkID0gamVzdC5mbigpO1xuICAgIFxuICAgIGNvbnN0IG5vdGlmaWVyID0gbmV3IFZlcnNpb25VcGRhdGVOb3RpZmllcih7XG4gICAgICBwb2xsaW5nSW50ZXJ2YWw6IG51bGwsXG4gICAgICBvblVwZGF0ZSxcbiAgICAgIG9uRGV0ZWN0ZWRcbiAgICB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuICBcbiAgLy8g6L6555WM5oOF5Ya15rWL6K+VXG4gIHRlc3QoJ+mHjeWkjeiwg+eUqOaWueazleS4jeS8muWvvOiHtOmUmeivrycsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IG5ldyBWZXJzaW9uVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IG51bGwgfSk7XG4gICAgXG4gICAgLy8g5rWL6K+V6YeN5aSN6LCD55SoXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIG5vdGlmaWVyLnN0YXJ0KCk7XG4gICAgICBub3RpZmllci5zdGFydCgpOyAvLyDph43lpI3osIPnlKhcbiAgICAgIG5vdGlmaWVyLnN0b3AoKTtcbiAgICAgIG5vdGlmaWVyLnN0b3AoKTsgLy8g6YeN5aSN6LCD55SoXG4gICAgICBub3RpZmllci5yZXNldCgpO1xuICAgICAgbm90aWZpZXIucmVzZXQoKTsgLy8g6YeN5aSN6LCD55SoXG4gICAgfSkubm90LnRvVGhyb3coKTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=