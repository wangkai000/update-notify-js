d87b7ee20bf6db1aaddd955294d26d20
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../src/index");
describe('UpdateNotifier 简化测试', () => {
    // 在每个测试前重置全局模拟
    beforeEach(() => {
        // 清除所有现有的模拟
        jest.clearAllMocks();
        // 基本的浏览器API模拟
        global.window = {
            ...global.window,
            confirm: jest.fn(() => true),
            setTimeout: jest.fn((callback) => {
                if (typeof callback === 'function') {
                    callback();
                }
                return 1;
            }),
            clearTimeout: jest.fn(),
            location: {
                reload: jest.fn()
            }
        };
        global.document = {
            ...global.document,
            addEventListener: jest.fn(),
            removeEventListener: jest.fn(),
            hidden: false,
        };
        global.fetch = jest.fn().mockResolvedValue({
            text: jest.fn().mockResolvedValue('<html><script src="/test.js"></script></html>')
        });
    });
    // 测试实例创建
    test('UpdateNotifier可以被实例化', () => {
        expect(() => new index_1.UpdateNotifier()).not.toThrow();
    });
    test('UpdateNotifier接受不同的配置选项', () => {
        const optionsList = [
            { pollingInterval: 10000 },
            { indexPath: '/custom-index.html' },
            { scriptRegex: /script/ },
            { promptMessage: '有新版本！' },
            { notificationType: 'confirm' },
            { immediate: false },
            { pauseOnHidden: false },
        ];
        optionsList.forEach(options => {
            expect(() => new index_1.UpdateNotifier(options)).not.toThrow();
        });
    });
    // 测试公共方法
    test('公共方法可以被安全调用', () => {
        const notifier = new index_1.UpdateNotifier({ pollingInterval: null });
        // 确保所有公共方法都可以被调用
        expect(() => notifier.start()).not.toThrow();
        expect(() => notifier.stop()).not.toThrow();
        expect(() => notifier.reset()).not.toThrow();
    });
    // 异步方法测试
    test('异步方法不会抛出未捕获的异常', async () => {
        const notifier = new index_1.UpdateNotifier({ pollingInterval: null });
        // 测试异步方法不会抛出未捕获的异常
        await expect(notifier.checkNow()).resolves.not.toThrow();
        await expect(notifier.checkUpdate()).resolves.not.toThrow();
    });
    // 回调函数测试
    test('回调函数配置有效', () => {
        const onUpdate = jest.fn(() => true);
        const onDetected = jest.fn();
        const notifier = new index_1.UpdateNotifier({
            pollingInterval: null,
            onUpdate,
            onDetected
        });
        expect(notifier).toBeDefined();
    });
    // 边界情况测试
    test('重复调用方法不会导致错误', () => {
        const notifier = new index_1.UpdateNotifier({ pollingInterval: null });
        // 测试重复调用
        expect(() => {
            notifier.start();
            notifier.start(); // 重复调用
            notifier.stop();
            notifier.stop(); // 重复调用
            notifier.reset();
            notifier.reset(); // 重复调用
        }).not.toThrow();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9pbmRleC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsd0NBQThDO0FBRTlDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsZUFBZTtJQUNmLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxZQUFZO1FBQ1osSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLGNBQWM7UUFDZCxNQUFNLENBQUMsTUFBTSxHQUFHO1lBQ2QsR0FBRyxNQUFNLENBQUMsTUFBTTtZQUNoQixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDNUIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtnQkFDL0IsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVLEVBQUUsQ0FBQztvQkFDbkMsUUFBUSxFQUFFLENBQUM7Z0JBQ2IsQ0FBQztnQkFDRCxPQUFPLENBQUMsQ0FBQztZQUNYLENBQUMsQ0FBQztZQUNGLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3ZCLFFBQVEsRUFBRTtnQkFDUixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTthQUNsQjtTQUNLLENBQUM7UUFFVCxNQUFNLENBQUMsUUFBUSxHQUFHO1lBQ2hCLEdBQUcsTUFBTSxDQUFDLFFBQVE7WUFDbEIsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMzQixtQkFBbUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzlCLE1BQU0sRUFBRSxLQUFLO1NBQ1AsQ0FBQztRQUVULE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO1lBQ3pDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlC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c0JBQWMsQ0FBQyxFQUFFLGVBQWUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRS9ELFNBQVM7UUFDVCxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ1YsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLE9BQU87WUFDekIsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2hCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQU87WUFDeEIsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLE9BQU87UUFDM0IsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ25CLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL1NoYXJlZC9QcmV2aW91c2x5IFJlbG9jYXRlZCBJdGVtcy9TZWN1cml0eS9teVByb2ppZWN0L2FpX3Byb2pldC90ZXN0cy9pbmRleC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFVwZGF0ZU5vdGlmaWVyIH0gZnJvbSAnLi4vc3JjL2luZGV4JztcblxuZGVzY3JpYmUoJ1VwZGF0ZU5vdGlmaWVyIOeugOWMlua1i+ivlScsICgpID0+IHtcbiAgLy8g5Zyo5q+P5Liq5rWL6K+V5YmN6YeN572u5YWo5bGA5qih5oufXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIOa4hemZpOaJgOacieeOsOacieeahOaooeaLn1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIC8vIOWfuuacrOeahOa1j+iniOWZqEFQSeaooeaLn1xuICAgIGdsb2JhbC53aW5kb3cgPSB7XG4gICAgICAuLi5nbG9iYWwud2luZG93LFxuICAgICAgY29uZmlybTogamVzdC5mbigoKSA9PiB0cnVlKSxcbiAgICAgIHNldFRpbWVvdXQ6IGplc3QuZm4oKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAxO1xuICAgICAgfSksXG4gICAgICBjbGVhclRpbWVvdXQ6IGplc3QuZm4oKSxcbiAgICAgIGxvY2F0aW9uOiB7XG4gICAgICAgIHJlbG9hZDogamVzdC5mbigpXG4gICAgICB9XG4gICAgfSBhcyBhbnk7XG4gICAgXG4gICAgZ2xvYmFsLmRvY3VtZW50ID0ge1xuICAgICAgLi4uZ2xvYmFsLmRvY3VtZW50LFxuICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxuICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxuICAgICAgaGlkZGVuOiBmYWxzZSxcbiAgICB9IGFzIGFueTtcbiAgICBcbiAgICBnbG9iYWwuZmV0Y2ggPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdGV4dDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCc8aHRtbD48c2NyaXB0IHNyYz1cIi90ZXN0LmpzXCI+PC9zY3JpcHQ+PC9odG1sPicpXG4gICAgfSk7XG4gIH0pO1xuICBcbiAgLy8g5rWL6K+V5a6e5L6L5Yib5bu6XG4gIHRlc3QoJ1VwZGF0ZU5vdGlmaWVy5Y+v5Lul6KKr5a6e5L6L5YyWJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiBuZXcgVXBkYXRlTm90aWZpZXIoKSkubm90LnRvVGhyb3coKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdVcGRhdGVOb3RpZmllcuaOpeWPl+S4jeWQjOeahOmFjee9rumAiemhuScsICgpID0+IHtcbiAgICBjb25zdCBvcHRpb25zTGlzdCA9IFtcbiAgICAgIHsgcG9sbGluZ0ludGVydmFsOiAxMDAwMCB9LFxuICAgICAgeyBpbmRleFBhdGg6ICcvY3VzdG9tLWluZGV4Lmh0bWwnIH0sXG4gICAgICB7IHNjcmlwdFJlZ2V4OiAvc2NyaXB0LyB9LFxuICAgICAgeyBwcm9tcHRNZXNzYWdlOiAn5pyJ5paw54mI5pys77yBJyB9LFxuICAgICAgeyBub3RpZmljYXRpb25UeXBlOiAnY29uZmlybScgYXMgY29uc3QgfSxcbiAgICAgIHsgaW1tZWRpYXRlOiBmYWxzZSB9LFxuICAgICAgeyBwYXVzZU9uSGlkZGVuOiBmYWxzZSB9LFxuICAgIF07XG4gICAgXG4gICAgb3B0aW9uc0xpc3QuZm9yRWFjaChvcHRpb25zID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiBuZXcgVXBkYXRlTm90aWZpZXIob3B0aW9ucykpLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuICBcbiAgLy8g5rWL6K+V5YWs5YWx5pa55rOVXG4gIHRlc3QoJ+WFrOWFseaWueazleWPr+S7peiiq+WuieWFqOiwg+eUqCcsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IG5ldyBVcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogbnVsbCB9KTtcbiAgICBcbiAgICAvLyDnoa7kv53miYDmnInlhazlhbHmlrnms5Xpg73lj6/ku6XooqvosIPnlKhcbiAgICBleHBlY3QoKCkgPT4gbm90aWZpZXIuc3RhcnQoKSkubm90LnRvVGhyb3coKTtcbiAgICBleHBlY3QoKCkgPT4gbm90aWZpZXIuc3RvcCgpKS5ub3QudG9UaHJvdygpO1xuICAgIGV4cGVjdCgoKSA9PiBub3RpZmllci5yZXNldCgpKS5ub3QudG9UaHJvdygpO1xuICB9KTtcbiAgXG4gIC8vIOW8guatpeaWueazlea1i+ivlVxuICB0ZXN0KCflvILmraXmlrnms5XkuI3kvJrmipvlh7rmnKrmjZXojrfnmoTlvILluLgnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgbm90aWZpZXIgPSBuZXcgVXBkYXRlTm90aWZpZXIoeyBwb2xsaW5nSW50ZXJ2YWw6IG51bGwgfSk7XG4gICAgXG4gICAgLy8g5rWL6K+V5byC5q2l5pa55rOV5LiN5Lya5oqb5Ye65pyq5o2V6I6355qE5byC5bi4XG4gICAgYXdhaXQgZXhwZWN0KG5vdGlmaWVyLmNoZWNrTm93KCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gICAgYXdhaXQgZXhwZWN0KG5vdGlmaWVyLmNoZWNrVXBkYXRlKCkpLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuICBcbiAgLy8g5Zue6LCD5Ye95pWw5rWL6K+VXG4gIHRlc3QoJ+Wbnuiwg+WHveaVsOmFjee9ruacieaViCcsICgpID0+IHtcbiAgICBjb25zdCBvblVwZGF0ZSA9IGplc3QuZm4oKCkgPT4gdHJ1ZSk7XG4gICAgY29uc3Qgb25EZXRlY3RlZCA9IGplc3QuZm4oKTtcbiAgICBcbiAgICBjb25zdCBub3RpZmllciA9IG5ldyBVcGRhdGVOb3RpZmllcih7XG4gICAgICBwb2xsaW5nSW50ZXJ2YWw6IG51bGwsXG4gICAgICBvblVwZGF0ZSxcbiAgICAgIG9uRGV0ZWN0ZWRcbiAgICB9KTtcbiAgICBcbiAgICBleHBlY3Qobm90aWZpZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuICBcbiAgLy8g6L6555WM5oOF5Ya15rWL6K+VXG4gIHRlc3QoJ+mHjeWkjeiwg+eUqOaWueazleS4jeS8muWvvOiHtOmUmeivrycsICgpID0+IHtcbiAgICBjb25zdCBub3RpZmllciA9IG5ldyBVcGRhdGVOb3RpZmllcih7IHBvbGxpbmdJbnRlcnZhbDogbnVsbCB9KTtcbiAgICBcbiAgICAvLyDmtYvor5Xph43lpI3osIPnlKhcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbm90aWZpZXIuc3RhcnQoKTtcbiAgICAgIG5vdGlmaWVyLnN0YXJ0KCk7IC8vIOmHjeWkjeiwg+eUqFxuICAgICAgbm90aWZpZXIuc3RvcCgpO1xuICAgICAgbm90aWZpZXIuc3RvcCgpOyAvLyDph43lpI3osIPnlKhcbiAgICAgIG5vdGlmaWVyLnJlc2V0KCk7XG4gICAgICBub3RpZmllci5yZXNldCgpOyAvLyDph43lpI3osIPnlKhcbiAgICB9KS5ub3QudG9UaHJvdygpO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==